!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=22)}([function(t,e,n){"use strict";var o=n(2);e.a=class{constructor(){this.componentList=new Set,this.subpackageList=new Set,this.collectAfter=new o.a}initialProperties(){}getInitialSubpackages(){return[]}}},function(t,e,n){"use strict";function o(t){return jQuery(t)}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));class o{constructor(){this.defaultContext=null,this.callbacks=[]}subscribe(t,e){!e&&this.defaultContext&&(e=this.defaultContext),e||(e=t);let n=this,o={callback:t,event:n,unsubscribe:function(){n.unsubscribe(t)}};return this.callbacks.push({callback:t,subscriber:e}),o}unsubscribe(t,e){!e&&this.defaultContext&&(e=this.defaultContext),e||(e=t);let n=[];for(let o=0;o<this.callbacks.length;o++)this.callbacks[o].callback!==t&&this.callbacks[o].subscriber!==e&&n.push(this.callbacks[o]);this.callbacks=n}trigger(t,e){for(let n=0;n<this.callbacks.length;n++)this.callbacks[n].callback.apply(this.callbacks[n].subscriber,[t,e])}}},function(t,e,n){"use strict";function o(t,e){return jQuery.proxy(t,e)}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";function o(t,e){return jQuery.extend(t,e)}n.d(e,"a",(function(){return o}))},,function(t,e,n){"use strict";function o(t){return JSON.parse(JSON.stringify(t))}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";var o=n(1),i=n(12),r=n(3);class s{constructor(t){this.component=t,this.rootElement=Object(o.a)(document.documentElement)}addWindowHandler(t,e,n){this.applyElementHandler(!0,{element:Object(o.a)(window),event:t,eventSelector:null,eventHandler:e,context:n})}removeWindowHandler(t,e,n){this.applyElementHandler(!1,{element:Object(o.a)(window),event:t,eventSelector:null,eventHandler:e,context:n})}addSystemHandler(t,e,n){n=this.getContext(n),t.subscribe(e,n)}removeSystemHandler(t,e,n){n=this.getContext(n),t.unsubscribe(e,n)}addElementHandler(t,e,n,o,i){this.applyElementHandler(!0,{element:t,event:e,eventSelector:n,eventHandler:o,context:i})}removeElementHandler(t,e,n,o,i){this.applyElementHandler(!1,{element:t,event:e,eventSelector:n,eventHandler:o,context:i})}applyElementHandler(t,e){e.context=this.getContext(e.context),e.eventSelector instanceof Function&&!e.eventHandler&&(e.eventHandler=e.eventSelector,e.eventSelector=""),e.context&&(e.eventHandler=Object(r.a)(e.eventHandler,e.context)),e.element instanceof Element&&(e.element=jQuery(e.element)),t?e.eventSelector?e.element.on(e.event,e.eventSelector,e.eventHandler):e.element.on(e.event,e.eventHandler):e.eventSelector?e.element.off(e.event,e.eventSelector,e.eventHandler):e.element.off(e.event,e.eventHandler)}getContext(t){return!t&&this.component&&(t=this.component),t}addEntityHandler(t,e,n,o,s){let a="",l=n;"string"==typeof n&&o instanceof Function&&(a=n,l=o),s||!o||o instanceof Function||(s=o),(s=this.getContext(s))&&(l=Object(r.a)(l,s));let c=Object(i.a)(t,a);this.rootElement.on(e,c,l)}removeEntityHandler(t,e,n,o,s){let a="",l=n;"string"==typeof n&&o instanceof Function&&(a=n,l=o),s||!o||o instanceof Function||(s=o),(s=this.getContext(s))&&(l=Object(r.a)(l,s));let c=Object(i.a)(t,a);this.rootElement.off(e,c,l)}addComponentHandler(t,e,n,o){this.addEntityHandler(this.component,t,e,n,o)}removeComponentHandler(t,e,n,o){this.removeEntityHandler(this.component,t,e,n,o)}addPackageHandler(t,e,n,o){this.addEntityHandler(this.component.package,t,e,n,o)}removePackageHandler(t,e,n,o){this.removeEntityHandler(this.component.package,t,e,n,o)}addPageElementHandler(t,e,n,o){this.applyElementHandler(!0,{element:this.rootElement,event:t,eventSelector:e,eventHandler:n,context:o})}removePageElementHandler(t,e,n,o){this.applyElementHandler(!1,{element:this.rootElement,event:t,eventSelector:e,eventHandler:n,context:o})}}e.a=class{constructor(t){this.eventManager=t||new s(this)}get app(){return this.package.app}initialProperties(){}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var o=n(3);class i{constructor(){this.observers=new Map}add(t,e,n){this.observers.has(t)||this.observers.set(t,[]),e=n?Object(o.a)(e,n):e,this.observers.get(t).push(e)}remove(t,e,n){this.observers.has(t)&&(e=n||Object(o.a)(e,this),this.observers.get(t).filter(t=>t!==e))}notify(t,e,n){this.observers.has(t)&&this.observers.get(t).forEach(o=>{o(e,n,t)})}}var r=n(6);function s(t,e,n){if("string"==typeof e)return s(t,e.split("."),n);if(1==e.length&&void 0!==n)return t[e[0]]=n;if(0==e.length)return Object(r.a)(t);if(!t.hasOwnProperty(e[0])){if(void 0===n)return;t[e[0]]={}}return s(t[e[0]],e.slice(1),n)}class a{constructor(t){this.observable=new i,t&&(this.container=t)}has(t){return void 0!==s(this.container,t)}get(t){return s(this.container,t)}set(t,e){let n=this.has(t)?this.get(t):null;s(this.container,t,e),"string"==typeof t&&t.split(".").length&&(t=t.split(".")[0]),this.observable.notify(t,e,n)}}},function(t,e,n){"use strict";function o(t){return jQuery(t.currentTarget)}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";var o;!function(t){t.remove="remove",t.virtual="virtual",t.published="published"}(o||(o={})),e.a=o},function(t,e,n){"use strict";function o(t,e){for(let n in t){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;let i=typeof t[n];if("object"==i){if(!o(t[n],e[n]))return!1}else if("function"==i){if(void 0===e[n]||t[n].toString()!=e[n].toString())return!1}else if(t[n]!=e[n])return!1}for(let n in e)if(void 0===t[n])return!1;return!0}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";function o(t,e){let n="";for(;;){let e=t.getParentEntity();if(!t.rootSelector){if(e){t=e;continue}break}if(n=0==n.length?t.rootSelector:t.rootSelector+" "+n,!e)break;t=e}return e&&(0==n.length?n=e:n+=" "+e),n}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));class o{}},function(t,e,n){"use strict";function o(t,e){return Object.getPrototypeOf(t)===Object.getPrototypeOf(e)&&(void 0!==t.length&&t.length===e.length&&Array.prototype.every.call(t,(t,n)=>t===e[n]))}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(1);class i{constructor(){this.objectContainer=new Map,this.componentRegister=new Map,this.packageRegister=new Map}get bodyElement(){return Object(o.a)(document.body)}get windowElement(){return Object(o.a)(window)}initialization(){}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(0);class i{buildByClass(t,e,n){let o=this.createPackageByClass(t,e,n);return this.build(o,e,n)}build(t,e,n){return t.app=e,t.parentPackage=n,this.createInteraction(t,e,n),this.afterInteractionBuilding(t,e),this.packageInitialProperties(t),this.packageAttachEvents(t),t.collectAfter.trigger(t),t}packageAttachEvents(t){t.componentList.forEach(t=>{t.attachEvents(t.eventManager)}),t.subpackageList.forEach(t=>{this.packageAttachEvents(t)})}packageInitialProperties(t){t.initialProperties(),t.componentList.forEach(t=>{t.initialProperties()}),t.subpackageList.forEach(t=>{this.packageInitialProperties(t)})}createInteraction(t,e,n){let i=t.getInitialSubpackages(),r=t.getInitialComponents();r&&r.forEach(e=>{e.package=t,t.componentList.add(e)}),i&&(i.forEach(n=>{let i=null;n instanceof o.a?(i=n,i.app=e,i.parentPackage=t):i=this.createPackageByClass(n,t.app,t),t.subpackageList.add(i)}),t.subpackageList.forEach(t=>{this.createInteraction(t,t.app,t.parentPackage)}))}createPackageByClass(t,e,n){if(!(t.prototype instanceof o.a))throw new TypeError('Ð¡lass does not implement class "PackageAbstract"');let i=new t;return i.app=e,i.parentPackage=n,i}afterInteractionBuilding(t,e){t.afterInteractionBuilding&&t.afterInteractionBuilding(e),t.componentList.size&&t.componentList.forEach(t=>{t.afterInteractionBuilding&&t.afterInteractionBuilding(e)}),t.subpackageList.size&&t.subpackageList.forEach(t=>{this.afterInteractionBuilding(t,e)})}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));class o{build(t,e){let n=new t;return e&&this.implementation(n,e),n}implementation(t,e){t.package=e,t.initialProperties(),t.attachEvents(t.eventManager)}}},function(t,e,n){"use strict";var o=n(7);class i extends o.a{constructor(t){super(),t&&(t instanceof Element&&(t=jQuery(t)),this.componentElement=t)}addElementHandler(t,e,n,o){this.eventManager.addElementHandler(this.componentElement,t,e,n,o)}removeElementHandler(t,e,n,o){this.eventManager.removeElementHandler(this.componentElement,t,e,n,o)}}e.a=i},function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var o=n(0),i=n(7),r=n(4),s=n(13),a=n(10);class l extends i.a{get register(){return this.app.objectContainer.get("Entity/Register")}initialProperties(){this.app.componentRegister.set("Entity/Collector",this)}attachEvents(t){}collectVirtualEntityByKey(t){let e=null;if(!this.register.has(t))throw new Error(`Entry by key '${t}' in register not found`);let n=this.register.get(t);return e=new s.a,e.status=a.a.virtual,e.entityId=this.createUniqueID(),e.parentId=0,e.entityKey=n.id,e.order=0,e.options=Object(r.a)({},n.defaultOptions),e.title=n.label,e.childEntities=[],e}collectEntityByStructure(t){let e=null;if(e=new s.a,e.status=a.a.published,e.entityId=t.entityId,e.parentId=t.parentId,e.entityKey=t.entityKey,e.order=Number(t.order),e.options=Object(r.a)({},t.options),e.title=t.title,e.childEntities=[],t.childEntities&&t.childEntities.hasOwnProperty("length")&&t.childEntities.length)for(let n in t.childEntities){if(!t.childEntities.hasOwnProperty(n))continue;let o=t.childEntities[n],i=this.collectEntityByStructure(o);e.childEntities.push(i)}return e}createUniqueID(){let t=()=>Math.random().toString(16).slice(-4);return"virtual-"+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}class c extends o.a{initialProperties(){let t=new Map;this.app.objectContainer.set("Entity/Register",t)}getInitialComponents(){return[new l]}}},,,function(t,e,n){"use strict";n.r(e);var o=n(15),i=n(16),r=n(17),s=n(19),a=n(0),l=n(7);class c extends l.a{initialProperties(){this.options={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"},this.app.componentRegister.set("TemplateLoader",this)}attachEvents(t){}loadTemplate(t,e){return null==e&&(e={}),window._.template(t,this.options)(e)}}class p extends a.a{getInitialComponents(){return[new c]}}var d=n(2);class h extends a.a{initialProperties(){this.app.objectContainer.set("Editor/Component/Prototypes",new Map)}getInitialComponents(){return[]}}class u extends a.a{initialProperties(){this.app.objectContainer.set("Editor/Panel/Prototypes",new Map)}getInitialComponents(){return[]}}var m=n(18);class g extends m.a{get prototypes(){return{projection:this.app.objectContainer.get("Editor/Projection/Prototypes"),panelLayout:this.app.objectContainer.get("Editor/PanelLayout/Prototypes"),panel:this.app.objectContainer.get("Editor/Panel/Prototypes"),component:this.app.objectContainer.get("Editor/Component/Prototypes"),control:this.app.objectContainer.get("Editor/Control/Prototypes"),controlSource:this.app.objectContainer.get("Editor/Control/Source/Prototypes")}}get register(){return{panelStructures:this.app.objectContainer.get("Editor/Panel/Structures"),components:this.app.objectContainer.get("Editor/Components"),entityTypes:this.app.objectContainer.get("Entity/Register"),componentPresets:this.app.objectContainer.get("Editor/Component/Presets"),controlRulesOperations:this.app.objectContainer.get("Editor/Control/RulesOperation")}}get builders(){return{control:this.app.componentRegister.get("Editor/Builder/Control"),panel:this.app.componentRegister.get("Editor/Builder/Panel"),panelLayout:this.app.componentRegister.get("Editor/Builder/PanelLayout"),projection:this.app.componentRegister.get("Editor/Builder/Projection"),component:this.app.componentRegister.get("Editor/Builder/Component")}}get projectEditorComponent(){return this.app.objectContainer.get("Editor/ProjectComponent")}get projectEntity(){return this.app.objectContainer.get("Editor/ProjectEntity")}get componentBuilder(){return this.app.objectContainer.get("ComponentBuilder")}get entityCollector(){return this.app.componentRegister.get("Entity/Collector")}get editorPackage(){return this.app.packageRegister.get("Editor/Package")}get localizedMessages(){return this.app.objectContainer.get("Messages")}get panelManager(){return this.app.componentRegister.get("Editor/PanelManager")}get projectionManager(){return this.app.componentRegister.get("Editor/ProjectionManager")}get templateLoader(){return this.app.componentRegister.get("TemplateLoader")}}var y=g;var f,E=class extends y{constructor(){super(),this.isControlsSavedProp=!0,this.controls=new Map,this.isControlsSavedChangedEvent=new d.a}get isControlsSaved(){return this.isControlsSavedProp}set isControlsSaved(t){let e=this.isControlsSavedProp;this.isControlsSavedProp=t,e!=t&&this.isControlsSavedChangedEvent.trigger({panelLayout:this,value:t})}get controlBuilder(){return this.app.componentRegister.get("Editor/Control/Builder")}get panelAutoSave(){return this.panelStructure.panelAutoSave}get panelId(){return this.panelStructure.panelId}get panelTitle(){return this.panelStructure.panelTitle}get controlElements(){return this.componentElement.find(".control[data-control-type]")}createControl(t){let e=this.builders.control.createControl(t,this),n=this.getControlElement(t.controlKey,t.optionKey);if(!n.length)throw new Error(`Element for option '${t.optionKey}' not found`);return e.componentElement=n,this.componentBuilder.implementation(e.controlSource,this.package),this.componentBuilder.implementation(e,this.package),this.eventManager.addSystemHandler(e.valueChangedEvent,this.onControlValueChanged),this.controls.set(e.optionKey,e),e}getControlElement(t,e){return this.controlElements.filter(`[data-control-type="${t}"][data-option-key="${e}"]`)}onControlValueChanged(t){this.panelAutoSave?(t.control.controlSource.saveValue(),this.isControlsSaved=!0):this.isControlsSaved=!1}attachEvents(t){}},v=n(1),C=n(9);class P extends E{attachEvents(t){super.attachEvents(t),t.addElementHandler(this.componentElement,"click",".tabs-heading-wrapper .tab-heading:not(.active-tab)",this.onTabClick),"validate"in this.panel&&this.panel.hasOwnProperty("validateEvent")&&t.addSystemHandler(this.panel.validateEvent,this.onValidatePanel)}onValidatePanel(){this.componentElement.find(".tab-content").each((t,e)=>{let n=Object(v.a)(e),o=n.data("tab-id"),i=this.componentElement.find(`.tab-heading[data-tab-id="${o}"]`),r=!1;for(let t of n.find(".error:not(.control-element)")){if(Object(v.a)(t).html().length){r=!0;break}}r?i.addClass("exists-errors"):i.removeClass("exists-errors")})}onTabClick(t){let e=Object(C.a)(t),n=e.data("tab-id");this.componentElement.find(".tab-heading.active-tab,.tab-content.active-tab").removeClass("active-tab"),e.addClass("active-tab"),this.componentElement.find(`.tab-content[data-tab-id="${n}"]`).addClass("active-tab")}assembleControls(t){let e=t.tabs;for(let t in e){let n=e[t];if(n.length)for(let t in n){let e=n[t];this.createControl(e)}}}}class b extends E{assembleControls(t){let e=t.controls;for(let t of e)this.createControl(t)}}class j extends a.a{initialProperties(){this.app.objectContainer.set("Editor/PanelLayout/Prototypes",new Map([["Tabs",P],["List",b]])),this.app.objectContainer.set("Editor/Panel/Structures",new Map)}getInitialComponents(){return[]}}class O extends a.a{initialProperties(){this.app.objectContainer.set("Editor/Projection/Prototypes",new Map)}getInitialComponents(){return[]}}!function(t){t[t.Launched=0]="Launched",t[t.Active=1]="Active",t[t.Inactive=2]="Inactive",t[t.Destroyed=3]="Destroyed",t[t.None=4]="None"}(f||(f={}));var w=f;function k(t){return class extends t{constructor(){super(...arguments),this.needReloadControl=!1}get controlLoader(){return this.app.componentRegister.get("Editor/Control/ControlLoader")}initialProperties(){super.initialProperties(),this.panel.status!=w.None&&this.initializeReloadRules()}checkDisplayRules(){super.checkDisplayRules(),this.needReloadControl&&this.isActiveControl&&(this.controlLoader.reloadControl(this),this.needReloadControl=!1)}onPanelStatusChanged(t){super.onPanelStatusChanged(t),t.status==w.Launched&&this.initializeReloadRules()}initializeReloadRules(){let e=this.controlStructure;if(e.reloadAfterInit&&(this.checkRules(this.controlStructure.displayRules)?this.controlLoader.reloadControl(this,()=>{this.restoreOptionValue()}):this.needReloadControl=!0),e.optionsDepends)for(let t of e.optionsDepends.values()){let e=this.getControlByOptionKey(t);e&&this.eventManager.addSystemHandler(e.valueChangedEvent,()=>{this.checkRules(this.controlStructure.displayRules)?(this.controlLoader.reloadControl(this,()=>{"afterReloadDependentOption"in this?this.afterReloadDependentOption():this.optionValue=this.getEmptyValue()}),this.needReloadControl=!1):this.needReloadControl=!0})}"initializeReloadRules"in t.prototype&&super.initializeReloadRules()}}}var S=n(14),V=n(11);class I extends y{constructor(){super(...arguments),this.parentControl=null,this.contextControls=new Map,this.valueChangedEvent=new d.a}get panel(){return this.panelLayout.panel}get controlKey(){return this.controlStructure.controlKey}get controlLabel(){return this.controlStructure.controlLabel}get optionKey(){return this.controlStructure.optionKey}get optionValue(){return this.optionValueProp}set optionValue(t){let e=this.optionValueProp,n=!0;this.optionValueProp=t,typeof e!=typeof t||e&&Array.isArray(e)&&!Object(S.a)(e,t)?n=!1:!e||Array.isArray(e)||"object"!=typeof e||Object(V.a)(e,t)?"object"!=typeof e&&e!=t&&(n=!1):n=!1,n||this.valueChangedEvent.trigger({oldValue:e,value:t,control:this})}get isActiveControl(){return!this.componentElement.hasClass("control-inactive")}set isActiveControl(t){t?(this.componentElement.removeClass("control-inactive"),this.showControlElement()):(this.componentElement.addClass("control-inactive"),this.hideControlElement())}showControlElement(){this.componentElement.slideDown(400)}hideControlElement(){this.componentElement.slideUp(400)}getEmptyValue(){return null}saveOptionValue(){this.controlSource.saveValue()}restoreOptionValue(){this.optionValueProp=this.controlSource.getValue()}initialProperties(){this.restoreOptionValue(),this.panel.status!=w.None&&this.initializeDisplayRules()}attachEvents(t){t.addSystemHandler(this.panel.statusChangedEvent,this.onPanelStatusChanged)}restoreDefaultOptionValue(t){this.controlStructure.defaultValue&&(t&&null==this.optionValue||!t)&&(this.optionValue=this.controlStructure.defaultValue)}initializeDisplayRules(){"object"==typeof this.controlStructure.displayRules&&Object.keys(this.controlStructure.displayRules).length?(this.attachObserversAccordingToRules(this.controlStructure.displayRules),this.checkDisplayRules()):this.restoreDefaultOptionValue(!0)}onPanelStatusChanged(t){t.status==w.Launched&&this.initializeDisplayRules()}attachObserversAccordingToRules(t){if(!(t.hasOwnProperty("relation")&&t.length-1==0||!t.hasOwnProperty("relation")&&0===t.length))for(let e in t){let n=t[e];if("relation"!=e)if(n.hasOwnProperty("relation")||!n.hasOwnProperty("optionKey"))this.attachObserversAccordingToRules(n);else{let t=this.getControlByOptionKey(n.optionKey);if(!t)continue;this.eventManager.addSystemHandler(t.valueChangedEvent,this.checkDisplayRules)}}}checkDisplayRules(){this.isActiveControl=this.checkRules(this.controlStructure.displayRules),this.isActiveControl&&this.restoreDefaultOptionValue(!0)}checkRules(t){let e="AND",n=Object.keys(t).length;if(t.hasOwnProperty("relation")&&(e=t.relation,n--),!n)return!0;for(let n in t){if("relation"==n)continue;let o=t[n],i=null;if(o.hasOwnProperty("relation")||!o.hasOwnProperty("optionKey"))i=this.checkRules(o);else{let t=this.getControlByOptionKey(o.optionKey);if(!t)continue;let e=t.optionValue,n=o.operation;if(!this.register.controlRulesOperations.has(n))continue;i=this.register.controlRulesOperations.get(n)(e,o)}if("AND"==e&&!i)return!1;if("OR"==e&&i)return!0}return"AND"==e}getControlByOptionKey(t){if(this.contextControls.has(t))return this.contextControls.get(t);if(this.parentControl instanceof I){let e=this.parentControl,n=null;for(;e;){if(n=e.getControlByOptionKey(t),n instanceof I)return n;if(!(e.parentControl instanceof I))break;e=e.parentControl}}return this.panelLayout.controls.has(t)?this.panelLayout.controls.get(t):null}}var R=I;var x=class extends R{constructor(){super(...arguments),this.isAttached=!1}get controlElement(){return this.componentElement.find(".control-element")}attachEvents(t){super.attachEvents(t),t.addSystemHandler(this.valueChangedEvent,this.onValueChangedEvent),this.isAttached=!0}restoreDefaultOptionValue(t){super.restoreDefaultOptionValue(t),!this.isAttached&&this.optionValue&&this.setElementValue(this.optionValue)}onValueChangedEvent(t){this.setElementValue(t.value)}restoreOptionValue(){super.restoreOptionValue(),this.setElementValue(this.optionValueProp)}updateValueFromElement(){this.optionValue=this.getElementValue()}},K=function(t,e,n,o){var i,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,n,s):i(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s};let M=class extends x{attachEvents(t){super.attachEvents(t),t.addElementHandler(this.componentElement,"change",".control-element",this.updateValueFromElement)}getEmptyValue(){return""}setElementValue(t){"string"!=typeof t&&(t=""),this.controlElement.val(t)}getElementValue(){return this.controlElement.val()}reloadControl(t){let e=t.controlElement.find(".control-element");this.controlElement.html(e.html())}};M=K([k],M);var L=M;class T extends x{attachEvents(t){super.attachEvents(t),t.addElementHandler(this.controlElement,"change paste keyup",this.updateValueFromElement)}getEmptyValue(){return""}setElementValue(t){"string"!=typeof t&&(t=""),this.controlElement.val(t)}getElementValue(){return this.controlElement.val()}}class H extends x{attachEvents(t){super.attachEvents(t),t.addPageElementHandler("change",".control-element",this.updateValueFromElement)}getEmptyValue(){return[]}setElementValue(t){this.controlElement.filter(":checked").prop("checked",!1),"string"==typeof t&&this.controlElement.filter(`[value="${t}"]`).prop("checked",!0)}getElementValue(){let t=this.controlElement.filter(":checked");if(t.length)return t.val()}}class A extends x{get unitSelectElement(){return this.componentElement.find(".select-unit")}attachEvents(t){super.attachEvents(t),t.addElementHandler(this.controlElement,"change paste keyup",this.updateValueFromElement),t.addElementHandler(this.unitSelectElement,"change",this.updateValueFromElement)}updateValueFromElement(){let t=this.controlElement.val();t=t.replace(/[^0-9\.]/g,""),this.controlElement.val(t),super.updateValueFromElement()}setElementValue(t){if("number"==typeof t&&(t+=""),"string"==typeof t&&t.length){let e=this.parseUnit(t);"string"!=typeof e[0]&&"number"!=typeof e[0]||isNaN(e[0])||this.controlElement.val(e[0]),this.unitSelectElement.val(e[1])}else this.controlElement.val(""),this.unitSelectElement.val("")}getElementValue(){let t=this.controlElement.val(),e=this.unitSelectElement.val();return t.length&&(t=parseFloat(t)),t+e}parseUnit(t){return"string"!=typeof t?[0,""]:[parseFloat(t),t.match(/[\d.\-\+]*\s*(.*)/)[1]||""]}}class B extends x{get firstOption(){return this.controlStructure.firstOption}get secondOption(){return this.controlStructure.secondOption}attachEvents(t){super.attachEvents(t),t.addElementHandler(this.controlElement,"change",this.updateValueFromElement)}setElementValue(t){t==this.firstOption.value?this.controlElement.prop("checked",!0):this.controlElement.prop("checked",!1)}getElementValue(){return this.controlElement.prop("checked")?this.firstOption.value:this.secondOption.value}}function $(t){let e=[];for(let n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e}var q=function(t,e,n,o){var i,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,n,s):i(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s};let F=class extends x{attachEvents(t){super.attachEvents(t),t.addElementHandler(this.componentElement,"change",".control-element",this.updateValueFromElement)}getEmptyValue(){return[]}setElementValue(t){if(null==t||null==t?t=[]:"string"==typeof t?t=[t]:Array.isArray(t)||"object"!=typeof t||(t=$(t)),this.controlElement.filter(":checked").prop("checked",!1),Array.isArray(t))for(let e of t.values()){this.controlElement.filter(`[value="${e}"]`).prop("checked",!0)}}getElementValue(){let t=[];return this.controlElement.filter(":checked").map((e,n)=>{let o=Object(v.a)(n);t.push(o.val())}),t}reloadControl(t){let e=t.controlElement.find(".check-box-list");this.componentElement.find(".check-box-list").html(e.html())}};F=q([k],F);var D=F,Q=n(6),_=function(t,e,n,o){var i,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,n,s):i(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s};let z=class extends R{constructor(){super(...arguments),this.childControls=[],this.reloadControlsQueue=[]}get controlLoader(){return this.app.componentRegister.get("Editor/Control/ControlLoader")}get itemsElement(){return this.listElement.find("> .repeater-item")}get listElement(){return this.componentElement.find(".repeater-list:first")}initialProperties(){super.initialProperties(),this.listElement.sortable({items:"> .repeater-item",handle:".sorting-repeater-item-handle",update:(t,e)=>{this.onItemMove()}})}restoreOptionValue(){let t=this.controlSource.getValue();"object"!=typeof t&&(t=[]),this.optionValueProp=t,this.changeValue(t)}initializeReloadRules(){let t=this.controlStructure.itemOptionsDepends,e=[];if(Object.keys(t).length)for(let n in t){let o=t[n];for(let t of o.values()){if(-1!==e.indexOf(t))continue;e.push(t);let n=this.getControlByOptionKey(t);n&&this.eventManager.addSystemHandler(n.valueChangedEvent,this.onItemDependChange)}}}attachEvents(t){super.attachEvents(t),this.panel.hasOwnProperty("afterInitValidationEvent")&&t.addSystemHandler(this.panel.afterInitValidationEvent,this.addRulesToRepeaterItems),t.addElementHandler(this.componentElement,"click",".repeater-bottom-navigation .add-item",this.onAddItemClick),t.addElementHandler(this.componentElement,"click",`.navigation-repeater-item[data-repeater-key="${this.optionKey}"] .add-empty-item`,this.onAddBeforeItemClick),t.addElementHandler(this.componentElement,"click",`.navigation-repeater-item[data-repeater-key="${this.optionKey}"] .remove-item`,this.onRemoveItemClick),t.addSystemHandler(this.valueChangedEvent,this.onValueChangedEvent)}onItemMove(){let t=[],e=[];this.itemsElement.each((n,o)=>{let i=Object(v.a)(o),r=i.attr("data-index");i.hasClass("ui-sortable-placeholder")||(t.push(this.optionValue[r]),e.push(this.childControls[r]))}),this.childControls=e,this.optionValue=Object(Q.a)(t)}onValueChangedEvent(t){this.changeValue(t.value)}onRemoveItemClick(t){let e=Object(v.a)(t.currentTarget).parents(".repeater-item:first"),n=parseInt(e.attr("data-index")),o=Object(Q.a)(this.optionValue);e.remove(),this.optionValue.splice(n,1),this.childControls.splice(n,1),this.refreshIndexes(),this.changeEventWithoutProcessing({oldValue:o,newValue:this.optionValue})}onAddBeforeItemClick(t){let e=Object(v.a)(t.currentTarget).parents(".repeater-item:first"),n=parseInt(e.attr("data-index")),o=Object(Q.a)(this.optionValue);this.optionValue.splice(n,0,{}),this.childControls.splice(n,0,{}),this.createItem(n,{refreshIndexes:!0}),this.changeEventWithoutProcessing({oldValue:o,newValue:this.optionValue})}onAddItemClick(t){this.createItem(-1)}changeValue(t){if(null==t||null==t?t=[]:Array.isArray(t)||"object"!=typeof t||(t=$(t),this.optionValueProp=t),Array.isArray(t)){if(t.length<this.childControls.length){for(let e=t.length;e<this.childControls.length;e++){let t=Object.keys(this.childControls[e])[0];this.childControls[e][t].componentElement.parents(".repeater-item:first").remove()}this.childControls.splice(t.length)}this.refreshIndexes();for(let[e,n]of t.entries())if(this.childControls.length-1>=e)for(let t in this.childControls[e]){let o=this.childControls[e][t];n.hasOwnProperty(t)?o.optionValue=n[t]:o.controlStructure.defaultValue?o.optionValue=o.controlStructure.defaultValue:o.optionValue=o.getEmptyValue()}else this.createItem(e,{reloadAfterInit:!1});this.reloadControlsQueue.length&&(this.controlLoader.reloadControls(this.reloadControlsQueue,t=>{for(let e of t)e.restoreOptionValue()}),this.reloadControlsQueue=[])}}refreshIndexes(){for(let[t,e]of this.optionValue.entries()){let e=this.itemsElement.eq(t);e.attr("data-index",t),e.find(`.sorting-repeater-item-handle[data-repeater-key="${this.optionKey}"] .index`).html(t+1+"");for(let e in this.childControls[t]){let n=this.childControls[t][e],o=n.optionKey,i=this.optionKey+"."+t+"."+e;n.componentElement.attr("data-option-key",i),n.controlStructure.optionKey=i,n.controlSource.optionKey=t+"."+e,n.componentElement.find(`[name="${o}"]`).attr("name",i),n instanceof H&&n.setElementValue(n.optionValue)}}let t=this.panel.formElement.data("validator");if(t&&Object.keys(t.invalid).length)for(let e in t.invalid)this.panel.formElement.find(`[id="${e}-error"]`).remove()}reloadControl(t){let e=this.controlStructure.resetValueOnReload;e&&(this.optionValue=[]);let n=t.controlElement.find("> .control-content > .repeater-item-template");this.componentElement.find("> .control-content > .repeater-item-template").html(n.html()),e||this.changeValue(this.optionValue)}renderRepeaterItem(t){return`\n            <div class="repeater-item" data-index="${t}">\n                <div class="repeater-item-handle sorting-repeater-item-handle" data-repeater-key="${this.optionKey}">\n                    <span class="index">${t+1}</span>\n                </div>\n                <div class="repeater-item-controls"></div>\n                <div class="repeater-item-handle navigation-repeater-item" data-repeater-key="${this.optionKey}">\n                    <div class="add-empty-item"></div>\n                    <div class="remove-item"></div>\n                </div>\n            </div>\n        `}addRulesToRepeaterItems(){let t=this.panel.formElement.data("validator");if(!t)return;let e=t.settings.rules,n=!1;if(e.hasOwnProperty(this.optionKey))n=e[this.optionKey];else for(let t in e){if(-1!==t.indexOf("*"))continue;let o=t.replace(/\./g,"\\.").split("*").join("([a-zA-Z\\d]+)");if(new RegExp(o).test(this.optionKey)){n=e[t];break}}if(n&&"object"==typeof n&&n.hasOwnProperty("repeaterItem")&&"object"==typeof n.repeaterItem)for(let t in this.childControls)for(let o in this.childControls[t]){let i=this.childControls[t][o];n.repeaterItem.hasOwnProperty(o)&&(e[i.optionKey]=n.repeaterItem[o])}}createItem(t,e){e=Object.assign({reloadAfterInit:!0,refreshIndexes:!1},e),-1==t&&(t=this.childControls.length),this.childControls[t]={};let n=new Map,o=this.controlStructure.controlStructures,i=Object(v.a)(this.renderRepeaterItem(t)),r=i.find(".repeater-item-controls"),s=this.componentElement.find(".repeater-list > .repeater-item").eq(t);t!=this.childControls.length&&s.length?s.before(i):this.componentElement.find(".repeater-list").append(i),e.refreshIndexes&&this.refreshIndexes();for(let i in o){let s=Object.assign({},o[i]),a=this.optionKey+"."+t+"."+i,l=s.optionKey;s.optionKey=a,s.controlSource="container";let c=this.builders.control.createControl(s,this.panelLayout),p=this.componentElement.find(`.repeater-item-template .control[data-control-type="${s.controlKey}"][data-option-key="${l}"]`);p.length&&(!e.reloadAfterInit&&s.hasOwnProperty("reloadAfterInit")&&s.reloadAfterInit&&(s.reloadAfterInit=!1,this.reloadControlsQueue.push(c)),n.set(this.optionKey+".repeaterItem."+i,c),n.set("repeaterItem."+i,c),c.contextControls=n,p=p.clone(),p.attr("data-option-key",a),p.find(`[name="${l}"]`).attr("name",a),c.parentControl=this,c.componentElement=p,c.controlSource.optionsContainer=this.optionValueProp,c.controlSource.optionKey=t+"."+i,r.append(p),this.componentBuilder.implementation(c.controlSource,this.package),this.eventManager.addSystemHandler(c.valueChangedEvent,this.onChildControlValueChanged),this.childControls[t][i]=c)}for(let e in this.childControls[t]){let n=this.childControls[t][e];this.componentBuilder.implementation(n,this.package)}this.panel.status==w.Active&&this.addRulesToRepeaterItems()}onChildControlValueChanged(t){let e=Object(Q.a)(this.optionValue),n=t.control.controlSource,o=n.optionsContainer;Array.isArray(e)||(e=$(this.optionValue));let i=Object(Q.a)(e);n.optionsContainer=i,n.saveValue(),this.optionValueProp=i,n.optionsContainer=o,Object(S.a)(e,this.optionValue)||this.changeEventWithoutProcessing({oldValue:e,newValue:this.optionValue})}changeEventWithoutProcessing(t){this.eventManager.removeSystemHandler(this.valueChangedEvent,this.onValueChangedEvent),this.valueChangedEvent.trigger({oldValue:t.oldValue,value:t.newValue,control:this}),this.eventManager.addSystemHandler(this.valueChangedEvent,this.onValueChangedEvent)}onItemDependChange(t){let e=this.controlStructure.itemOptionsDepends,n=t.control.optionKey,o=[],i=[];if(Object.keys(e).length)for(let t in e){-1===e[t].indexOf(n)||o.push(t)}for(let t of o.values())for(let[e,n]of this.childControls.entries())n.hasOwnProperty(t)&&i.push(n[t]);i.length&&this.controlLoader.reloadControls(i,t=>{for(let e of t)e.optionValue=e.getEmptyValue()})}};z=_([k],z);var U=z;class G extends x{showControlElement(){this.componentElement.show()}hideControlElement(){this.componentElement.hide()}get colorPickerElement(){return this.componentElement.find(".color-picker-element")}initialProperties(){let t=()=>{this.updateValueFromElement()};this.colorPickerElement.wpColorPicker({hide:!0,change:t,clear:t}),super.initialProperties()}setElementValue(t){"string"!=typeof t&&(t=""),t.length?this.colorPickerElement.wpColorPicker("color",t):this.colorPickerElement.iris("color","")}getElementValue(){return this.colorPickerElement.wpColorPicker("color")}}var W=n(3);class N extends R{constructor(){super(...arguments),this.isAttached=!1,this.attachmentQuery=null}initialProperties(){super.initialProperties(),this.mediaFrame=wp.media({multiple:!1,library:{type:"image"}})}attachEvents(t){super.attachEvents(t),t.addSystemHandler(this.valueChangedEvent,this.onValueChangedEvent),t.addElementHandler(this.componentElement,"click",".upload-container .upload-image",this.onUpdateButtonClick),t.addElementHandler(this.componentElement,"click",".image-container .delete-image",this.onRemoveButtonClick),this.mediaFrame.on("select",Object(W.a)(this.onSelectImage,this))}onRemoveButtonClick(){this.optionValue=null}onUpdateButtonClick(){this.mediaFrame.open()}onSelectImage(){let t=this.mediaFrame.state().get("selection").first().toJSON();this.optionValue=t.id,this.eventManager.removeSystemHandler(this.valueChangedEvent,this.onValueChangedEvent),this.updateOptionValue({id:t.id,url:t.url}),this.eventManager.addSystemHandler(this.valueChangedEvent,this.onValueChangedEvent)}restoreDefaultOptionValue(t){super.restoreDefaultOptionValue(t),!this.isAttached&&this.optionValue&&this.updateOptionValue({id:this.optionValue})}onValueChangedEvent(t){this.updateOptionValue({id:t.value})}restoreOptionValue(){super.restoreOptionValue(),this.updateOptionValue({id:this.optionValueProp})}updateOptionValue(t){let e=t.id,n=this.componentElement.find(".control-input-element"),o=this.componentElement.find(".upload-container"),i=this.componentElement.find(".image-container");if(this.attachmentQuery&&this.attachmentQuery.abort(),!e)return n.val(""),this.updatePreviewImage(""),o.removeClass("woocommerce-product-filter-hidden"),void i.addClass("woocommerce-product-filter-hidden");if(o.addClass("woocommerce-product-filter-hidden"),i.removeClass("woocommerce-product-filter-hidden"),t.hasOwnProperty("url"))this.updatePreviewImage(t.url);else{let t=wp.media.attachment(e);this.attachmentQuery=t.sync("read"),this.attachmentQuery.done(t=>{this.updatePreviewImage(t.url)}).fail(()=>{this.updatePreviewImage("")})}n.val(e)}updatePreviewImage(t){this.componentElement.find(".image-element").attr("src",t)}}var J=function(t,e,n,o){var i,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,n,s):i(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s};let Z=class extends R{constructor(){super(...arguments),this.isRestoredOption=!1,this.images={},this.attachmentQuery={}}get controlLoader(){return this.app.componentRegister.get("Editor/Control/ControlLoader")}initialProperties(){super.initialProperties(),this.mediaFrame=wp.media({multiple:!1,library:{type:"image"}}),this.mediaFrame.on("select",Object(W.a)(this.onSelectImage,this))}getEmptyValue(){return{}}restoreOptionValue(){super.restoreOptionValue();let t=this.controlStructure.taxonomiesColors;if(Array.isArray(this.optionValue)||"object"!=typeof this.optionValue){if(!t.hasOwnProperty(this.optionKey))return void(this.optionValueProp={});this.optionValueProp=Object(Q.a)(t[this.optionKey])}else if(!Array.isArray(this.optionValue)&&"object"==typeof this.optionValue&&t.hasOwnProperty(this.optionKey)){let e=Object(Q.a)(t[this.optionKey]);this.optionValueProp=jQuery.extend(e,this.optionValueProp)}this.isRestoredOption=!0;for(let t in this.optionValue){let e=this.optionValue[t],n=this.componentElement.find(`.color-item[data-term=${t}]`);e.image&&n.find(".image-element").attr("src")&&(this.images[e.image]=n.find(".image-element").attr("src")),this.changeMarkerStyleSwitch(e.term,e.markerStyle),this.changeTypeSwitch(e.term,e.type),this.changeBorderColorElement(e.term,e.borderColor,!0),this.changeColorElement(e.term,e.color,!0),this.changeImageElement(e.term,e.image)}this.isRestoredOption=!1}onSelectImage(){let t=this.mediaFrame.$el.data("term"),e=this.mediaFrame.state().get("selection").first().toJSON();this.images[e.id]=e.url,this.changeImageElement(t,e.id)}changeImageElement(t,e){let n=this.componentElement.find(`.color-item[data-term=${t}]`).find(".image-container");if(this.attachmentQuery.hasOwnProperty(t)&&this.attachmentQuery[t]&&this.attachmentQuery[t].abort(),this.changeColorOption(t,"image",e),n.find(".image-element").attr("src",""),e&&!this.images.hasOwnProperty(e)){let o=wp.media.attachment(e);this.attachmentQuery[t]=o.sync("read"),this.attachmentQuery[t].done(t=>{this.images[e]=t.url,n.find(".image-element").attr("src",t.url)}).always(()=>{this.updatePreviewColor(t)})}else e&&this.images.hasOwnProperty(e)&&n.find(".image-element").attr("src",this.images[e]);this.updatePreviewColor(t)}changeColorElement(t,e,n=!1){let o=this.componentElement.find(`.color-item[data-term=${t}]`),i=o.find(".color-picker-element"),r=o.find(".preview-color");if(n&&(i.wpColorPicker("color",e),!e||!e.length)){i.parents(".wp-picker-container").find(".wp-color-result").css("background-color","")}"color"==this.optionValue[t].type&&r.css("background",e),this.changeColorOption(t,"color",e)}changeBorderColorElement(t,e,n=!1){let o=this.componentElement.find(`.color-item[data-term=${t}]`),i=o.find(".border-picker-element"),r=o.find(".preview-color");if(n&&(i.wpColorPicker("color",e),!e||!e.length)){i.parents(".wp-picker-container").find(".wp-color-result").css("background-color","")}r.css("border-color",e),this.changeColorOption(t,"borderColor",e)}changeMarkerStyleSwitch(t,e){let n=this.componentElement.find(`.color-item[data-term=${t}]`).find('.switch-element[data-name="marker"]');this.changeSwitchElement(n,e),this.changeColorOption(t,"markerStyle",e)}changeTypeSwitch(t,e){let n=this.componentElement.find(`.color-item[data-term=${t}]`),o=n.find('.switch-element[data-name="type"]');this.changeSwitchElement(o,e),"color"==e?(n.find(".image-container").hide(),n.find(".color-picker-container").show()):"image"==e&&(n.find(".image-container").show(),n.find(".color-picker-container").hide()),this.changeColorOption(t,"type",e),this.updatePreviewColor(t)}updatePreviewColor(t){let e=this.componentElement.find(`.color-item[data-term=${t}]`),n=e.find(".preview-color"),o=this.optionValue[t].image;if("color"==this.optionValue[t].type)n.css("background-image",""),n.css("background",this.optionValue[t].color);else if("image"==this.optionValue[t].type){let t=e.find(".image-container .preview-image-container"),i=e.find(".image-container .upload-container");n.css("background",""),o&&this.images.hasOwnProperty(o)?(n.css("background-image",`url(${this.images[o]})`),t.removeClass("woocommerce-product-filter-hidden"),i.addClass("woocommerce-product-filter-hidden")):(n.css("background-image",""),t.addClass("woocommerce-product-filter-hidden"),i.removeClass("woocommerce-product-filter-hidden"))}}changeSwitchElement(t,e){t.find(".option.active").removeClass("active"),t.find(`.option[data-value="${e}"]`).addClass("active")}reloadControl(t){this.componentElement.find(".control-content").html(t.controlElement.find(".control-content").html()),this.initialElementProperties(),this.attachElementEvents(this.eventManager)}afterReloadDependentOption(){this.restoreOptionValue()}initialElementProperties(){let t=t=>{setTimeout(()=>{let e=jQuery(t.target),n=e.parents(".color-item:first"),o=e.hasClass("wp-picker-clear")?"":e.val();this.changeColorElement(n.data("term"),o)},1)},e=t=>{setTimeout(()=>{let e=jQuery(t.target),n=e.parents(".color-item:first"),o=e.hasClass("wp-picker-clear")?"":e.val();this.changeBorderColorElement(n.data("term"),o)},1)};this.componentElement.find(".color-picker-element").wpColorPicker({hide:!0,palettes:!0,change:t,clear:t}),this.componentElement.find(".border-picker-element").wpColorPicker({hide:!0,palettes:!0,change:e,clear:e})}attachEvents(t){super.attachEvents(t),t.addElementHandler(this.componentElement,"click",".image-container .upload-container .upload-image",this.onUpdateImageClick),t.addElementHandler(this.componentElement,"click",".image-container .delete-image",this.onRemoveImageClick),t.addElementHandler(this.componentElement,"mouseenter",'.switch-element[data-name="marker"] .option',this.onMarkerMouseEnter),t.addElementHandler(this.componentElement,"mouseleave",'.switch-element[data-name="marker"] .option',this.onMouseLeaveEnter)}attachElementEvents(t){t.addElementHandler(this.componentElement.find(".switch-element"),"click",".option:not(.active)",this.onSwitchClick)}onMarkerMouseEnter(t){let e=jQuery(t.currentTarget);e.parents(".color-item:first").addClass("marker-preview").addClass("marker-preview-"+e.data("value"))}onMouseLeaveEnter(t){let e=jQuery(t.currentTarget);e.parents(".color-item:first").removeClass("marker-preview").removeClass("marker-preview-"+e.data("value"))}onRemoveImageClick(t){let e=jQuery(t.currentTarget).parents(".color-item:first");this.changeImageElement(e.data("term"),"")}onUpdateImageClick(t){let e=jQuery(t.currentTarget).parents(".color-item:first");this.mediaFrame.open(e),this.mediaFrame.$el.data("term",e.data("term"))}onSwitchClick(t){let e=jQuery(t.currentTarget),n=e.parents(".color-item:first"),o=e.parents(".switch-element").data("name"),i=e.data("value");"type"==o?this.changeTypeSwitch(n.data("term"),i):"marker"==o&&this.changeMarkerStyleSwitch(n.data("term"),i)}changeColorOption(t,e,n){if(this.optionValue[t][e]==n)return;let o=Object(Q.a)(this.optionValue);this.optionValue[t][e]=n,this.isRestoredOption||this.valueChangedEvent.trigger({oldValue:o,value:this.optionValue,control:this})}};Z=J([k],Z);var Y=Z;class X extends R{constructor(){super(...arguments),this.isRestoredOption=!1}getEmptyValue(){return[]}getGroupPosition(t){for(let e in this.optionValue){if(this.optionValue[e].id==t)return e}return-1}getRulePosition(t,e){let n=this.getGroupOption(t).rules;for(let t in n){if(n[t].id==e)return t}return-1}getGroupOption(t){for(let e in this.optionValue){let n=this.optionValue[e];if(n.id==t)return n}return null}getRuleOption(t,e){let n=this.getRulePosition(t,e),o=this.getGroupOption(t);return-1!==n?o.rules[n]:null}setRuleOption(t,e,n,o){let i=this.getRulePosition(t,e),r=this.getGroupOption(t);-1!==i?r.rules[i]={id:e,rule:n}:o?r.rules.splice(o,0,{id:e,rule:n}):r.rules.push({id:e,rule:n})}hasRuleOption(t,e){let n=this.getGroupOption(t).rules;for(let t in n){if(n[t].id==e)return!0}return!1}hasGroupOption(t){for(let e in this.optionValue){if(this.optionValue[e].id==t)return!0}return!1}deleteRuleOption(t,e){let n=this.getGroupOption(t),o=this.getRulePosition(t,e);-1!==o&&n.rules.splice(o,1)}deleteGroupOption(t){let e=this.getGroupPosition(t);-1!==e&&this.optionValue.splice(e,1)}restoreOptionValue(){if(this.isRestoredOption=!0,super.restoreOptionValue(),"object"!=typeof this.optionValue||!this.optionValue||!this.hasGroupOption("group_0")||!this.hasRuleOption("group_0","rule_0")){"object"==typeof this.optionValue&&this.optionValue||(this.optionValueProp=[]),this.hasGroupOption("group_0")||this.optionValueProp.push({id:"group_0",rules:[]}),this.getGroupOption("group_0").rules.push({id:"rule_0",rule:{param:this.controlStructure.useEntries[0],operator:"==",value:null}})}let t=null;for(let e in this.optionValue){let n=this.optionValue[e],o=this.getGroupElement(n.id);if(!o.length&&n.rules)this.createEmptyGroup(n.id,t),o=this.getGroupElement(n.id);else if(o.length&&!n.rules){this.deleteGroupOption(n.id);continue}let i=null;for(let t in n.rules){let e=n.rules[t],o=this.getRuleElement(n.id,e.id);o.length||(this.createEmptyRule(n.id,e.id,i),o=this.getRuleElement(n.id,e.id)),this.setRuleOptions(n.id,e.id,e.rule),i=o}t=o}this.componentElement.find(".rule-group[data-id]").each((t,e)=>{let n=jQuery(e),o=n.data("id");this.hasGroupOption(o)?n.find(".rule-row[data-id]").each((t,e)=>{let n=jQuery(e),i=n.data("id");this.hasRuleOption(o,i)||n.remove()}):n.remove()}),this.initSelect2(),this.isRestoredOption=!1}initSelect2(){this.componentElement.find(".value-select").select2({width:"100%",closeOnSelect:!0})}setRuleOptions(t,e,n,o){let i=this.getRuleElement(t,e);i.find(".operator-select").val(n.operator),i.find(".param-select").val(n.param);let r=Object(Q.a)(this.optionValue);this.setRuleOption(t,e,n,o),this.isRestoredOption||this.valueChangedEvent.trigger({oldValue:r,value:this.optionValue,control:this}),this.reloadEntries(t,e)}attachEvents(t){super.attachEvents(t),t.addElementHandler(this.componentElement,"change",".rule-row .param-select",this.onParamChange),t.addElementHandler(this.componentElement,"change",".rule-row .operator-select",this.onOperatorChange),t.addElementHandler(this.componentElement,"change",".rule-row .value-select",this.onEntryValueChange),t.addElementHandler(this.componentElement,"click",".rule-row .add-rule.button",this.onAddRuleButtonClick),t.addElementHandler(this.componentElement,"click",".rule-row .remove-rule.button",this.onRemoveRuleButtonClick),t.addElementHandler(this.componentElement,"click",".rule-groups .add-rule-group.button",this.onAddGroupButtonClick)}compileTemplate(t,e){return window._.template(t,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"})(e)}getRuleElement(t,e){return this.componentElement.find(`.rule-group[data-id="${t}"] .rule-row[data-id="${e}"]`)}getGroupElement(t){return this.componentElement.find(`.rule-group[data-id="${t}"]`)}generateUniqueId(){return"_"+Math.random().toString(36).substr(2,9)}onRemoveRuleButtonClick(t){let e=jQuery(t.currentTarget).parents(".rule-row:first"),n=e.data("id"),o=e.parents(".rule-group:first").data("id"),i=e.parents(".rules-table-body"),r=Object(Q.a)(this.optionValue);"rule_0"==n&&"group_0"==o||(i.find(".rule-row").length<=1&&"group_0"!=o?(this.getGroupElement(o).remove(),this.deleteGroupOption(o)):(e.remove(),this.deleteRuleOption(o,n)),this.valueChangedEvent.trigger({oldValue:r,value:this.optionValue,control:this}))}onAddGroupButtonClick(t){let e=this.generateUniqueId(),n=this.compileTemplate(this.controlStructure.groupRuleTemplateHtml,{groupId:e}),o=jQuery(n),i=this.generateUniqueId();this.componentElement.find(".rule-group").length?o.insertAfter(this.componentElement.find(".rule-group:last")):this.componentElement.find(".rule-groups").prepend(o);let r={param:this.controlStructure.useEntries[0],operator:"==",value:null};this.optionValue.push({id:e,rules:[]}),this.createEmptyRule(e,i),this.setRuleOptions(e,i,r)}createEmptyGroup(t,e){let n=this.compileTemplate(this.controlStructure.groupRuleTemplateHtml,{groupId:t}),o=jQuery(n);e?o.insertAfter(e):this.componentElement.find(".rule-group").length?o.insertAfter(this.componentElement.find(".rule-group:last")):this.componentElement.find(".rule-groups").prepend(o)}createEmptyRule(t,e,n){let o=this.compileTemplate(this.controlStructure.ruleTemplateHtml,{groupId:t,ruleId:e}),i=jQuery(o);n?i.insertAfter(n):this.getGroupElement(t).find(".rules-table-body").append(i),this.initSelect2()}onAddRuleButtonClick(t){let e=jQuery(t.currentTarget),n=e.parents(".rule-row:first").data("id"),o=e.parents(".rule-group:first").data("id"),i=this.getRuleElement(o,n),r=this.generateUniqueId();this.createEmptyRule(o,r,i);let s=this.getGroupOption(o),a=this.getRulePosition(o,n),l={param:this.controlStructure.useEntries[0],operator:"==",value:null};s.rules.splice(a+1,0,{id:r,rule:l}),this.setRuleOptions(o,r,l,a+1)}onEntryValueChange(t){let e=jQuery(t.currentTarget),n=e.parents(".rule-row:first").data("id"),o=e.parents(".rule-group:first").data("id"),i=e.val();this.changeRuleOption(o,n,"value",i)}onOperatorChange(t){let e=jQuery(t.currentTarget),n=e.parents(".rule-row:first").data("id"),o=e.parents(".rule-group:first").data("id"),i=e.val();this.changeRuleOption(o,n,"operator",i)}onParamChange(t){let e=jQuery(t.currentTarget),n=e.parents(".rule-row:first").data("id"),o=e.parents(".rule-group:first").data("id"),i=e.val();this.changeRuleOption(o,n,"param",i),this.reloadEntries(o,n)}reloadEntries(t,e){let n=this.getRuleOption(t,e).rule.param,o=this.getValueElementByRule(t,e);o.data("wcpf-loaded-options",!1),o.parents("td:first").block(),X.optionsElements.hasOwnProperty(n)?this.updateElementsWithParams(n):(!X.optionsQueries.hasOwnProperty(n)||4==X.optionsQueries[n].readyState&&200!=X.optionsQueries[n].status)&&(X.optionsQueries[n]=wp.ajax.send("wcpf_editor_rules_builder_get_options",{type:"POST",dataType:"json",data:{param:n,wcpf_tabs_panel_nonce:wcpf_tabs.nonce_save}}).done(t=>{t&&t.hasOwnProperty("optionsHtml")?(X.optionsElements[n]=jQuery(t.optionsHtml),this.updateElementsWithParams(n)):X.optionsQueries.hasOwnProperty(n)&&delete X.optionsQueries[n]}))}updateElementsWithParams(t){if("object"==typeof this.optionValue&&this.optionValue)for(let e in this.optionValue){let n=this.optionValue[e];for(let e in n.rules){let o=n.rules[e];if(o.rule.param!=t)continue;let i=this.getValueElementByRule(n.id,o.id);i.data("wcpf-loaded-options")||(i.html(X.optionsElements[t].html()),i.data("wcpf-loaded-options",!0),i.parents("td:first").unblock()),this.isRestoredOption=!0,i.val(o.rule.value),i.trigger("change"),this.isRestoredOption=!1}}}getValueElementByRule(t,e){return this.componentElement.find(`.rule-group[data-id="${t}"] .rule-row[data-id="${e}"] .value-select`)}changeRuleOption(t,e,n,o){this.optionValue&&"object"==typeof this.optionValue||(this.optionValueProp=[]);let i=this.getRuleOption(t,e);if(i&&i.rule[n]==o)return;let r=Object(Q.a)(this.optionValue);i.rule[n]=o,this.isRestoredOption||this.valueChangedEvent.trigger({oldValue:r,value:this.optionValue,control:this})}}X.optionsElements={},X.optionsQueries={};class tt extends l.a{get prototypes(){return{projection:this.app.objectContainer.get("Editor/Projection/Prototypes"),panelLayout:this.app.objectContainer.get("Editor/PanelLayout/Prototypes"),panel:this.app.objectContainer.get("Editor/Panel/Prototypes"),component:this.app.objectContainer.get("Editor/Component/Prototypes"),control:this.app.objectContainer.get("Editor/Control/Prototypes"),controlSource:this.app.objectContainer.get("Editor/Control/Source/Prototypes")}}get register(){return{panelStructures:this.app.objectContainer.get("Editor/Panel/Structures"),components:this.app.objectContainer.get("Editor/Components"),entityTypes:this.app.objectContainer.get("Entity/Register"),componentPresets:this.app.objectContainer.get("Editor/Component/Presets"),controlRulesOperations:this.app.objectContainer.get("Editor/Control/RulesOperation")}}get builders(){return{control:this.app.componentRegister.get("Editor/Builder/Control"),panel:this.app.componentRegister.get("Editor/Builder/Panel"),panelLayout:this.app.componentRegister.get("Editor/Builder/PanelLayout"),projection:this.app.componentRegister.get("Editor/Builder/Projection"),component:this.app.componentRegister.get("Editor/Builder/Component")}}get projectEditorComponent(){return this.app.objectContainer.get("Editor/ProjectComponent")}get projectEntity(){return this.app.objectContainer.get("Editor/ProjectEntity")}get componentBuilder(){return this.app.objectContainer.get("ComponentBuilder")}get entityCollector(){return this.app.componentRegister.get("Entity/Collector")}get editorPackage(){return this.app.packageRegister.get("Editor/Package")}get localizedMessages(){return this.app.objectContainer.get("Messages")}get panelManager(){return this.app.componentRegister.get("Editor/PanelManager")}get projectionManager(){return this.app.componentRegister.get("Editor/ProjectionManager")}get templateLoader(){return this.app.componentRegister.get("TemplateLoader")}}var et=tt;var nt=class extends et{get panel(){return this.control.panel}get optionKey(){return this.control.optionKey}get optionValue(){return this.control.optionValue}attachEvents(t){}};class ot extends nt{saveValue(){let t=this.optionValue;"object"==typeof t&&(t=Object(Q.a)(t)),this.panel.options.set(this.optionKey,t)}getValue(){let t=this.panel.options.has(this.optionKey)?Object(Q.a)(this.panel.options.get(this.optionKey)):void 0;return"object"==typeof t&&(t=Object(Q.a)(t)),t}}class it extends nt{saveValue(){if(this.panel.hasOwnProperty("editorComponent")){let t=this.panel.editorComponent;(t.hasOwnProperty(this.optionKey)||this.optionKey in t)&&(t[this.optionKey]=this.optionValue)}}getValue(){if(this.panel.hasOwnProperty("editorComponent")){let t=this.panel.editorComponent;if(t.hasOwnProperty(this.optionKey)||this.optionKey in t)return t[this.optionKey]}}}var rt=n(8);class st extends nt{constructor(t){super(),this.optionKeyProp=null,this.optionsRepository=new rt.a,t&&(this.optionsRepository.container=t)}set optionsContainer(t){this.optionsRepository.container=t}get optionsContainer(){return this.optionsRepository.container}get optionKey(){return this.optionKeyProp?this.optionKeyProp:this.control.optionKey}set optionKey(t){this.optionKeyProp=t}saveValue(){this.optionsRepository.set(this.optionKey,this.optionValue)}getValue(){return this.optionsRepository.has(this.optionKey)?this.optionsRepository.get(this.optionKey):void 0}}var at=n(4);class lt extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){let e=this.register.controlRulesOperations;e.set("==",this.isEqualToOperator),e.set("!=",this.isNotEqualToOperator),e.set(">",this.greaterThanOperator),e.set("<",this.lessThanOperator),e.set(">=",this.greaterThanOrEqualToOperator),e.set("<=",this.lessThanOrEqualToOperator),e.set("in",this.inOperator),e.set("inControl",this.inControlOperator),e.set("notIn",this.notInOperator),e.set("notInControl",this.notInControlOperator)}isEqualToOperator(t,e){return Array.isArray(t)?(t=Object(at.a)({},t),Object(V.a)(t,e.value)):t==e.value}isNotEqualToOperator(t,e){return!this.isEqualToOperator(t,e)}greaterThanOperator(t,e){return t>e.value}lessThanOperator(t,e){return!this.greaterThanOperator(t,e)}greaterThanOrEqualToOperator(t,e){return t>=e.value}lessThanOrEqualToOperator(t,e){return t<=e.value}inOperator(t,e){return-1!==e.value.indexOf(t)}inControlOperator(t,e){return Array.isArray(t)?-1!==t.indexOf(e.value):"object"==typeof t&&"hasOwnProperty"in t&&t.hasOwnProperty(e.value)}notInOperator(t,e){return!this.inOperator(t,e)}notInControlOperator(t,e){return!this.inControlOperator(t,e)}}class ct extends et{constructor(){super(),this.controlRequests=new Map}initialProperties(){this.app.componentRegister.set("Editor/Control/ControlLoader",this)}attachEvents(t){}reloadControls(t,e){let n=[];for(let e of t.values())n.push(this.collectControlProps(e));this.reloadRequest(n,t,e)}reloadControl(t,e){this.reloadRequest([this.collectControlProps(t)],[t],e)}collectControlProps(t){let e=new rt.a({});for(let n of t.panelLayout.controls.values())e.set(n.optionKey,n.optionValue);let n={},o={},i=[t],r=[],s=t.parentControl,a={};for(t.panel.hasOwnProperty("editorComponent")&&(a=t.panel.editorComponent.entity);s instanceof R;)i.push(s),s=s.parentControl;i.reverse();for(let t of i.values()){r.push(t.optionKey);for(let[e,n]of t.contextControls.entries())o[e]=n.optionValue;n[t.optionKey]=Object.assign({},o)}return{options:e.container,context:o,optionKey:t.optionKey,panelKey:t.panel.panelKey,controlPath:r,parentsContext:n,entity:a}}reloadRequest(t,e,n){for(let t of e.values())this.controlRequests.has(t)&&this.controlRequests.get(t).abort(),t.componentElement.block();let o=wp.ajax.send("wcpf_editor_control_reload",{type:"POST",dataType:"json",data:{controls:JSON.stringify(t),wcpf_tabs_panel_nonce:wcpf_tabs.nonce_save}}).done(t=>{if(t.items&&Array.isArray(t.items)){for(let[n,o]of t.items.entries()){if("object"!=typeof o)continue;let t=e[n],i={prevStructure:t.controlStructure,structure:o.structure,controlHtml:o.controlHtml,controlElement:Object(v.a)(o.controlHtml)};t.controlStructure=o.structure,"reloadControl"in t&&t.reloadControl(i)}n&&n(e)}}).always(()=>{for(let t of e.values())t.componentElement.unblock()});for(let t of e.values())this.controlRequests.set(t,o)}}class pt extends a.a{initialProperties(){this.app.objectContainer.set("Editor/Control/Prototypes",new Map([["Select",L],["Text",T],["RadioList",H],["TextSize",A],["Switch",B],["CheckList",D],["Repeater",U],["ColorPicker",G],["Image",N],["ColorList",Y],["RulesBuilder",X]])),this.app.objectContainer.set("Editor/Control/Source/Prototypes",new Map([["options",ot],["entity",it],["container",st]])),this.app.objectContainer.set("Editor/Control/RulesOperation",new Map)}getInitialComponents(){return[new lt,new ct]}}class dt extends et{initialProperties(){this.app.componentRegister.set("Editor/Builder/Control",this)}attachEvents(t){}createControl(t,e){if(!this.prototypes.control.has(t.controlKey))throw new Error(`Control class not found by type '${t.controlKey}'`);let n=this.prototypes.control.get(t.controlKey),o=this.componentBuilder.build(n);if(!this.prototypes.controlSource.has(t.controlSource))throw new Error(`Control source by key '${t.controlSource}' not found`);let i=this.prototypes.controlSource.get(t.controlSource),r=this.componentBuilder.build(i);return r.control=o,o.controlSource=r,e&&(o.panelLayout=e),o.controlStructure=t,o}}class ht extends et{initialProperties(){this.app.componentRegister.set("Editor/Builder/Panel",this)}attachEvents(t){}createPanel(t,e,n){if(!this.prototypes.panel.has(t))throw new Error(`Panel controller with id '${t}' not found`);if(n&&!this.register.components.has(n))throw new Error(`Editor element with id '${n}' not found`);let o=this.prototypes.panel.get(t),i=this.componentBuilder.build(o);if(i.panelKey=t,i.panelContext=e,!n&&i.hasOwnProperty("editorComponent"))throw new Error(`For controller of '${t}' panel, need entity`);if(n){let t=this.register.components.get(n);i.editorComponent=t,t.hasOwnProperty("panels")&&t.panels.add(i)}return i}}class ut extends et{initialProperties(){this.app.componentRegister.set("Editor/Builder/PanelLayout",this)}attachEvents(t){}createPanelLayout(t){if(!this.register.panelStructures.has(t))throw new Error(`Panel structure with id '${t}' not found`);let e=this.register.panelStructures.get(t),n=this.prototypes.panelLayout.get(e.panelLayoutKey),o=this.componentBuilder.build(n);return o.panelStructure=e,o}}var mt=n(13);function gt(t,e){if(e.entityId==t)return e;let n=null,o=[];for(let i in e.childEntities){let r=e.childEntities[i];if(r.childEntities.length&&o.push(r),r.entityId==t){n=r;break}}if(null==n)for(let e in o){let i=gt(t,o[e]);if(i instanceof mt.a){n=i;break}}return n}class yt extends et{initialProperties(){this.app.componentRegister.set("Editor/Builder/Projection",this)}attachEvents(t){}createProjectionByEntityId(t){let e=gt(t,this.projectEntity);if(null==e)throw new Error(`Entity by id '${t}' not found`);return this.createProjectionByEntity(e)}createProjectionByEntity(t){if(!this.register.components.has(t.entityId))throw new Error(`Element by entity id '${t.entityId}' not found`);return this.createProjectionByComponent(this.register.components.get(t.entityId))}createProjectionByComponent(t){return this.createProjectionByKey(t.entityKey,t)}createProjectionByKey(t,e){if(!e.hasOwnProperty("projection"))throw new Error(`Element '#${e.entityId} - ${e.entityTitle}' does not have projection support`);if(!this.prototypes.projection.has(t))throw new Error(`Projection controller prototype by key '${t}' not found`);let n=this.prototypes.projection.get(t),o=this.componentBuilder.build(n);return e&&(o.editorComponent=e,e.projection=o),o.projectionKey=t,o.package=this.package,o}}class ft extends et{initialProperties(){this.app.componentRegister.set("Editor/Builder/Component",this)}attachEvents(t){}createComponentByEntityId(t){let e=gt(t,this.projectEntity);if(null==e)throw new Error(`Entity by id '${t}' not found`);return this.createComponentByEntity(e)}createComponentByEntity(t){if(!this.prototypes.component.has(t.entityKey))throw new Error(`Element prototype by entity key '${t.entityKey}' not found`);this.isNumeric(t.entityId)&&(t.entityId=parseFloat(t.entityId)),this.isNumeric(t.parentId)&&(t.parentId=parseFloat(t.parentId));let e=this.prototypes.component.get(t.entityKey),n=this.componentBuilder.build(e);if(n.entity=t,this.register.components.set(t.entityId,n),this.componentBuilder.implementation(n,this.package),t.childEntities.length)for(let e in t.childEntities){let n=t.childEntities[e];this.createComponentByEntity(n)}return n}isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}}class Et extends a.a{getInitialComponents(){return[new dt,new ht,new ut,new yt,new ft]}}class vt extends y{constructor(){super(),this.optionsContainer={},this.statusProp=w.None,this.statusChangedEvent=new d.a}get options(){return this.optionsRepository}get status(){return this.statusProp}set status(t){let e=this.statusProp;this.statusProp=t,e!=t&&this.statusChangedEvent.trigger({panel:this,oldStatus:e,status:this.statusProp})}get isControlsSaved(){return this.panelLayout.isControlsSaved}set isControlsSaved(t){this.panelLayout.isControlsSaved=t}get formElement(){return this.componentElement.find("form.panel-form")}initialProperties(){this.optionsRepository=this.createOptionsRepository()}createOptionsRepository(){return new rt.a(this.optionsContainer)}attachEvents(t){t.addSystemHandler(this.statusChangedEvent,this.onStatusChanged),this.panelLayout.panelAutoSave||(t.addSystemHandler(this.panelLayout.isControlsSavedChangedEvent,this.onIsControlsSavedChanged),this.addElementHandler("click",".panel-navigation .reset-panel-button",this.resetValuesOfControls),this.addElementHandler("click",".panel-navigation .apply-panel-button",this.saveValuesOfControls)),t.addElementHandler(this.formElement,"submit",this.onFormSubmit)}onFormSubmit(t){t.preventDefault()}onStatusChanged(t){let e=new Map([[w.Active,"onActive"],[w.Inactive,"onInactive"],[w.Launched,"onLaunched"],[w.Destroyed,"onDestroyed"]]);if(e.has(t.status)&&e.get(t.status)in t.panel){let n=t.panel[e.get(t.status)];n=Object(W.a)(n,this),n()}}onIsControlsSavedChanged(){let t=this.componentElement.find(".panel-navigation .reset-panel-button"),e=this.componentElement.find(".panel-navigation .apply-panel-button");this.panelLayout.isControlsSaved?(t.addClass("disabled"),e.addClass("disabled")):(t.removeClass("disabled"),e.removeClass("disabled"))}saveValuesOfControls(){if(!this.panelLayout.isControlsSaved){for(let t of this.panelLayout.controls.values())t.saveOptionValue();this.panelLayout.isControlsSaved=!0}}resetValuesOfControls(){if(!this.panelLayout.isControlsSaved){for(let t of this.panelLayout.controls.values())t.restoreOptionValue();this.panelLayout.isControlsSaved=!0}}getTemplateContext(t){return{}}}class Ct extends vt{attachEvents(t){super.attachEvents(t),this.options.observable.add("field",this.onElementSelect,this),this.options.observable.add("preset",this.onElementSelect,this),this.options.observable.add("layout",this.onElementSelect,this)}onElementSelect(t){let e=t.elementCode,n=t.defaultState;if(!this.register.entityTypes.has(e))return;let o=this.entityCollector.collectVirtualEntityByKey(e);"object"==typeof n&&(o=Object(at.a)(o,n)),o.parentId=this.projectEntity.entityId,this.projectEntity.childEntities.push(o);let i=this.builders.component.createComponentByEntity(o);i.hasOwnProperty("projection")&&this.projectionManager.addProjection(i),this.prototypes.panel.has(o.entityKey)?this.panelManager.openPanel(o.entityKey,o.entityId):(this.panelManager.backPanel(),i.hasOwnProperty("projection")&&this.projectionManager.scrollToProjection(i))}}class Pt extends x{attachEvents(t){t.addElementHandler(this.componentElement,"click",".element-item[data-element-code]",this.onItemClick)}onItemClick(t){let e=Object(C.a)(t);this.setElementValue({elementCode:e.data("element-code"),defaultState:e.data("default-state")}),this.updateValueFromElement()}setElementValue(t){this.componentElement.find(".element-item[data-element-code].selected").removeClass("selected"),"object"==typeof t&&this.componentElement.find(`.element-item[data-element-code="${t.elementCode}"]`).addClass("selected")}getElementValue(){let t=this.componentElement.find(".element-item[data-element-code].selected");return t.length?{elementCode:t.data("element-code"),defaultState:t.data("default-state")}:null}}class bt extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.panel.set("AddElement",Ct),t.control.set("ElementList",Pt)}}class jt extends a.a{getInitialComponents(){return[new bt]}}var Ot=n(12);function wt(t,e){var n=Object(Ot.a)(t,e);return n?jQuery(n):null}class kt extends l.a{constructor(){super(...arguments),this.rootSelector=""}get rootElement(){return wt(this)}getParentEntity(){return t=this.package,e="rootSelector",t&&t.hasOwnProperty(e)?this.package:null;var t,e}getEntityElement(t){return wt(this,t)}}var St=kt;var Vt=class extends St{get prototypes(){return{projection:this.app.objectContainer.get("Editor/Projection/Prototypes"),panelLayout:this.app.objectContainer.get("Editor/PanelLayout/Prototypes"),panel:this.app.objectContainer.get("Editor/Panel/Prototypes"),component:this.app.objectContainer.get("Editor/Component/Prototypes"),control:this.app.objectContainer.get("Editor/Control/Prototypes"),controlSource:this.app.objectContainer.get("Editor/Control/Source/Prototypes")}}get register(){return{panelStructures:this.app.objectContainer.get("Editor/Panel/Structures"),components:this.app.objectContainer.get("Editor/Components"),entityTypes:this.app.objectContainer.get("Entity/Register"),componentPresets:this.app.objectContainer.get("Editor/Component/Presets"),controlRulesOperations:this.app.objectContainer.get("Editor/Control/RulesOperation")}}get builders(){return{control:this.app.componentRegister.get("Editor/Builder/Control"),panel:this.app.componentRegister.get("Editor/Builder/Panel"),panelLayout:this.app.componentRegister.get("Editor/Builder/PanelLayout"),projection:this.app.componentRegister.get("Editor/Builder/Projection"),component:this.app.componentRegister.get("Editor/Builder/Component")}}get projectEditorComponent(){return this.app.objectContainer.get("Editor/ProjectComponent")}get projectEntity(){return this.app.objectContainer.get("Editor/ProjectEntity")}get componentBuilder(){return this.app.objectContainer.get("ComponentBuilder")}get entityCollector(){return this.app.componentRegister.get("Entity/Collector")}get editorPackage(){return this.app.packageRegister.get("Editor/Package")}get localizedMessages(){return this.app.objectContainer.get("Messages")}get panelManager(){return this.app.componentRegister.get("Editor/PanelManager")}get projectionManager(){return this.app.componentRegister.get("Editor/ProjectionManager")}get templateLoader(){return this.app.componentRegister.get("TemplateLoader")}};function It(t,e){Object(v.a)("html,body").animate({scrollTop:t},e)}var Rt,xt=n(10);class Kt extends Vt{constructor(){super(...arguments),this.rootSelector=".woocommerce-product-filter-manage-project-wrapper",this.rowModeWidth=1140}initialProperties(){jQuery.hasOwnProperty("blockUI")&&(jQuery.blockUI.defaults.message=null)}attachEvents(t){t.addWindowHandler("load",this.onWindowLoaded),t.addComponentHandler("click",".editor-panel .navigation .save-project",this.saveProject),t.addComponentHandler("click",".editor-panel .navigation .add-element",this.onAddElementClick),t.addComponentHandler("click",".panel.projections-panel .view-mode-toggle .view-mode",this.onViewModeClick),t.addWindowHandler("resize",this.onWindowResize)}onViewModeClick(t){let e=Object(C.a)(t).data("mode");this.setMode(e)}setMode(t){this.rootElement.find(".panel.editor-panel").attr("data-panel-mode",t),this.rootElement.find(".panel.projections-panel .view-mode-toggle .view-mode.active").removeClass("active"),this.rootElement.find(`.panel.projections-panel .view-mode-toggle .view-mode[data-mode="${t}"]`).addClass("active")}getMode(){let t=this.rootElement.find(".panel.editor-panel").attr("data-panel-mode");return t||(window.innerWidth<this.rowModeWidth?"row":"column")}onWindowResize(t){window.innerWidth<this.rowModeWidth&&this.setMode("row")}onWindowLoaded(t){if(!window.hasOwnProperty("ProductFilterData"))return;window.innerWidth<this.rowModeWidth?this.setMode("row"):this.setMode("column");let e=window.ProductFilterData,n=(this.builders.component,null);if("edit"!=e.pageAction&&"new"!=e.pageAction)return;this.app.objectContainer.set("PageLinks",{listProject:e.pageLinks.list_project,newProject:e.pageLinks.new_project,editProject:e.pageLinks.edit_project}),this.app.objectContainer.set("Messages",e.messages);for(let t in e.editor.panels){let n=e.editor.panels[t];this.register.panelStructures.set(t,n)}for(let t in e.registerEntities){let n=e.registerEntities[t];this.register.entityTypes.set(t,{id:n.id,label:n.label,isGrouped:n.is_grouped,defaultOptions:n.default_options})}if(this.editorPackage.initEditorEvent.trigger(this.prototypes),window.hasOwnProperty("ProductFilterProjectData")){let t=window.ProductFilterProjectData;n=this.entityCollector.collectEntityByStructure(t)}else n=this.entityCollector.collectVirtualEntityByKey("Project");"new"==e.pageAction&&e.postId&&(n.entityId=e.postId,n.status=xt.a.published);let o=this.builders.component.createComponentByEntity(n);if(this.app.objectContainer.set("Editor/ProjectEntity",n),this.app.objectContainer.set("Editor/ProjectComponent",o),this.editorPackage.projectLoadedEvent.trigger(this.register),this.panelManager.openPanel(n.entityKey,n.entityId),this.panelManager.activePanels.length){let t=this.panelManager.activePanels[0];this.panelManager.checkCorrectnessOfOptions(t)}"new"==e.pageAction&&o.titleChangedEvent.trigger({title:o.entityTitle,oldTitle:o.entityTitle,entity:o.entity,editorComponent:o})}saveProject(){let t=this.app.bodyElement.find("#wpcontent"),e=this.panelManager.activePanels,n=this.app.bodyElement.find(".wcpf-notices-container");if(e.length)for(let t of e){if(!this.panelManager.checkCorrectnessOfOptions(t))return;if(this.panelManager.modalToSaveOptions(t),!this.panelManager.checkCorrectnessOfOptions(t))return}t.block(),wp.ajax.send("wcpf_save_project",{type:"POST",dataType:"json",data:{projectEntity:JSON.stringify(this.projectEntity),wcpf_tabs_panel_nonce:wcpf_tabs.nonce_save}}).fail(t=>{if(n.html(""),t.hasOwnProperty("messages")&&t.messages.length){for(let e of t.messages)n.append(this.getMessageTemplate(e));It(n.offset().top-window.innerHeight/2,400)}}).done(t=>{if(n.html(""),t.hasOwnProperty("projectId")){let e=this.app.objectContainer.get("PageLinks").editProject;e=e.replace(/\%project_id\%/g,t.projectId),location.href=e}}).always(()=>{t.unblock()})}onAddElementClick(){this.panelManager.openPanel("AddElement")}getMessageTemplate(t){return`<div class="${t.level} ${t.level}-level-message">\n                <p class="text">${t.text}</p>\n            </div>`}}class Mt extends Vt{constructor(){super(...arguments),this.rootSelector=".page-editor-container .panel.options-panel",this.activePanels=[]}initialProperties(){this.app.componentRegister.set("Editor/PanelManager",this)}attachEvents(t){t.addComponentHandler("click",".action-back-panel-on-click",this.backPanel)}checkIfPanelIsOpen(t,e,n){for(let o in this.activePanels){let i=this.activePanels[o];if(n&&i.hasOwnProperty("editorComponent")){if(i.editorComponent.entityId==n&&i.panelKey==t&&Object(V.a)(e,i.panelContext))return!0}else if(i.panelKey==t&&Object(V.a)(e,i.panelContext))return!0}return!1}getCurrentPanel(){return this.activePanels.length?this.activePanels[this.activePanels.length-1]:null}openPanel(t,e,n){if("string"!=typeof e&&"number"!=typeof e||(n=e,e={}),!t.length)throw new Error("Parameter panel key is empty");if(e||(e={}),this.checkIfPanelIsOpen(t,e,n))return;if(this.activePanels.length){let t=this.activePanels[this.activePanels.length-1];if(!this.checkCorrectnessOfOptions(t))return;if(this.modalToSaveOptions(t),!this.checkCorrectnessOfOptions(t))return}let o=this.getTemplate(t);if(null==o)throw new Error(`Panel template with id '${t}' not found`);let i=this.builders.panelLayout.createPanelLayout(t),r=this.builders.panel.createPanel(t,e,n);i.panel=r,r.panelLayout=i,r.package=this.package,r.initialProperties();let s=Object(v.a)(o(r.getTemplateContext(r.panelContext)));if(s.hide(),this.rootElement.append(s),r.componentElement=i.componentElement=s,this.componentBuilder.implementation(i,this.package),i.assembleControls(i.panelStructure),r.attachEvents(r.eventManager),r.status=w.Launched,this.activePanels.length){let t=this.activePanels[this.activePanels.length-1],e=t.componentElement;if(t.status=w.Inactive,this.activePanels.length>1){if(t.status=w.Destroyed,t.hasOwnProperty("editorComponent")){let e=t.editorComponent;e.hasOwnProperty("panels")&&e.panels.delete(t)}this.activePanels.pop(),this.animationOpen(e,s,(t,e)=>{t.remove()})}else this.animationOpen(e,s)}else s.show(),s.addClass("status-active");r.status=w.Active,this.activePanels.push(r)}backPanel(t){if(t||(t={}),t=Object(at.a)({ignoreValidation:!1},t),this.activePanels.length<=1)return;let e=this.activePanels[this.activePanels.length-1],n=e.componentElement;if(!t.ignoreValidation&&!this.checkCorrectnessOfOptions(e))return;if(this.modalToSaveOptions(e),!t.ignoreValidation&&!this.checkCorrectnessOfOptions(e))return;let o=this.activePanels[this.activePanels.length-2],i=o.componentElement;if(e.status=w.Inactive,o.status=w.Active,e.status=w.Destroyed,e.hasOwnProperty("editorComponent")){let t=e.editorComponent;t.hasOwnProperty("panels")&&t.panels.delete(e)}this.activePanels.pop(),this.animationBack(n,i,(t,e)=>{t.remove()})}checkCorrectnessOfOptions(t){return!("validate"in t)||t.validate()}modalToSaveOptions(t){if(!t.isControlsSaved){let e=this.localizedMessages.panel.shouldSaveOptionsOnPanel;e=e.replace(/--panel-title/g,t.panelLayout.panelTitle),confirm(e)?t.saveValuesOfControls():t.resetValuesOfControls()}}scrollToPanelElement(t){let e=Object(v.a)("#wpadminbar"),n=t.offset().top,o=window.scrollY-n;if(o>200||o<-200){let t=n-20;"fixed"==e.css("position")&&(t-=e.height()),It(t,500)}}animationOpen(t,e,n){e.addClass("status-launched"),e.show(),t.removeClass("status-active").addClass("status-inactive"),e.addClass("status-active"),setTimeout(()=>{e.removeClass("status-launched"),n&&n(t,e)},600),this.scrollToPanelElement(e)}animationBack(t,e,n){t.removeClass("status-active").addClass("status-destroyed"),e.removeClass("status-inactive").addClass("status-active"),setTimeout(()=>{n&&n(t,e)},600)}getTemplate(t){let e=this.app.bodyElement.find(`.wcpf-panel-template[data-panel-key=${t}]`);if(!e.length)return null;let n=e.attr("id");return n&&0===n.indexOf("tmpl-")?wp.template(n.slice(5)):null}}!function(t){t[t.inside=0]="inside",t[t.outside=1]="outside",t[t.same=2]="same"}(Rt||(Rt={}));var Lt=Rt;class Tt extends Vt{constructor(){super(...arguments),this.rootSelector=".page-editor-container .panel.projections-panel",this.activeProjectionsProp=[],this.sortableOptions={},this.sortingIsInitialized=!1}get activeProjections(){return this.activeProjectionsProp}get containerElement(){return this.rootElement.find(".projections-container")}initialProperties(){this.app.componentRegister.set("Editor/ProjectionManager",this),this.sortableSelectors=[".projections-container",".sort-list"],this.sortableRootSelectors=this.sortableSelectors.map(t=>".page-editor-container .projections-panel "+t).join(","),this.sortableOptions={items:".sort-item",acceptFrom:this.sortableSelectors.join(", "),placeholder:'<div class="projection projection-placeholder"></div>',forcePlaceholderSize:!1}}attachEvents(t){t.addSystemHandler(this.editorPackage.projectLoadedEvent,this.onProjectLoaded),t.addWindowHandler("load",this.onWindowLoad)}onWindowLoad(t){this.attachSortableEvents(),sortable(this.sortableRootSelectors,this.sortableOptions),this.sortingIsInitialized=!0}reloadSortable(){if(!this.sortingIsInitialized)return;sortable(this.sortableRootSelectors,"destroy"),sortable(this.sortableRootSelectors,this.sortableOptions),this.attachSortableEvents();let t=sortable(this.sortableRootSelectors,"serialize");for(let e in t){let n=t[e];for(let t in n.items){let e=n.items[t],o=Object(v.a)(e.node).data("entity-id");this.register.components.has(o)&&(this.register.components.get(o).entityOrder=t)}}}attachSortableEvents(){let t=this.app.bodyElement.find(this.sortableRootSelectors),e="wcpf-is-attached-sortable-events";t.each((t,n)=>{let o=Object(v.a)(n);o.data(e)||(n.addEventListener("sortupdate",Object(W.a)(this.onSortUpdate,this)),o.data(e,!0))})}onSortUpdate(t){let e={node:t.detail.origin.container,items:t.detail.origin.items},n={node:t.detail.destination.container,items:t.detail.destination.items},o={node:t.detail.item},i=!1;for(let t of[n,e,o])t.editorComponent=null,t.projection=null,t.element=Object(v.a)(t.node),t.element.hasClass("sort-list")&&(t.element=t.element.parents(".sort-item:first")),t.element.hasClass("projections-container")?t.entityId=this.projectEntity.entityId:t.entityId=t.element.data("entity-id"),this.register.components.has(t.entityId)&&(t.editorComponent=this.register.components.get(t.entityId),t.editorComponent&&t.editorComponent.hasOwnProperty("projection")&&(t.projection=t.editorComponent.projection));n.element.get(0).isSameNode(e.element.get(0))&&(i=!0);let r={editorComponent:o.editorComponent,nextContainerComponent:n.editorComponent,prevContainerComponent:e.editorComponent};o.editorComponent&&(n.editorComponent?o.editorComponent.entityParentId=n.editorComponent.entityId:o.editorComponent.entityParentId=this.projectEntity.entityId),o.projection&&o.projection.moveProjectionEvent.trigger(Object(at.a)({isSameContainer:i},r)),i?n.projection&&n.projection.hasOwnProperty("moveChildProjectionEvent")&&n.projection.moveChildProjectionEvent.trigger(Object(at.a)({direction:Lt.same},r)):(n.projection&&n.projection.hasOwnProperty("moveChildProjectionEvent")&&n.projection.moveChildProjectionEvent.trigger(Object(at.a)({direction:Lt.inside},r)),e.projection&&e.projection.hasOwnProperty("moveChildProjectionEvent")&&e.projection.moveChildProjectionEvent.trigger(Object(at.a)({direction:Lt.outside},r)));for(let t of i?[n]:[e,n])for(let e in t.items){let n=0;if(n=Object(v.a)(t.items[e]).data("entity-id"),this.register.components.has(n)){this.register.components.get(n).entityOrder=e}}}onProjectLoaded(){for(let t of this.register.components.values())this.prototypes.projection.has(t.entityKey)&&t.hasOwnProperty("projection")&&this.addProjection(t)}hasProjection(t){for(let e in this.activeProjections){if(this.activeProjections[e].editorComponent.entityId==t.entityId)return!0}return!1}addProjection(t){if(this.hasProjection(t))return;if(!this.prototypes.projection.has(t.entityKey))throw new Error(`Projection controller prototype with id '${t.entityKey}' not found`);if(!t.hasOwnProperty("projection"))throw new Error(`Element '#${t.entityId} - ${t.entityTitle}' does not have projection support`);let e=this.builders.projection.createProjectionByComponent(t),n=this.getTemplate(e.projectionKey);if(null==n)throw new Error(`Projection template with id '${e.projectionKey}' not found`);this.activeProjectionsProp.push(e),e.initialProperties();let o=Object(v.a)(n(e.getTemplateContext()));e.componentElement=o;let i=!0;if(t.entityParentId&&this.register.components.has(t.entityParentId)){let e=this.register.components.get(t.entityParentId),n=!1;for(;;){if(e.hasOwnProperty("projection")){n=!0;break}if(!this.register.components.has(e.entityParentId))break;e=this.register.components.get(e.entityParentId)}if(n){!e.projection&&this.prototypes.projection.has(e.entityKey)&&this.addProjection(e);let n=e.projection;n&&"insertChildComponentElement"in n&&(n.insertChildComponentElement(o,t),i=!1)}}if(i&&this.containerElement.append(o),e.initialProjection(),e.attachEvents(e.eventManager),t.entity.childEntities.length)for(let e in t.entity.childEntities){let n=t.entity.childEntities[e],o=this.register.components.get(n.entityId);o&&o.hasOwnProperty("projection")&&this.addProjection(o)}this.reloadSortable(),this.triggerZoneState()}moveProjection(t,e){if(!t.hasOwnProperty("projection"))throw new Error(`Element '#${t.entityId} - ${t.entityTitle}' does not have projection support`);let n=!0,o=(t.projection,this.containerElement),i=this.containerElement;if(this.register.components.has(t.entity.parentId)){let e=this.register.components.get(t.entity.parentId);e.hasOwnProperty("projection")&&e.projection&&(o=e.projection.componentElement)}if(e.hasOwnProperty("projection")){let o=e.projection;o&&"insertChildComponentElement"in o&&(o.insertChildComponentElement(t.projection.componentElement,t),i=o.componentElement,n=!1)}n&&this.containerElement.append(t.projection.componentElement);let r="> "+this.sortableSelectors.join(", > ");this.onSortUpdate({detail:{origin:{container:o.get(0),items:o.find(r).toArray()},destination:{container:i.get(0),items:i.find(r).toArray()},item:t.projection.componentElement.get(0)}})}removeProjection(t,e){if(!t.hasOwnProperty("projection"))throw new Error(`Element '#${t.entityId} - ${t.entityTitle}' does not have projection support`);if(!confirm(this.localizedMessages.projection.shouldRemoveElement))return;let n=t.projection;if(n){if(t.entity.childEntities.length)for(let e of t.entity.childEntities)this.register.components.has(e.entityId)&&this.moveProjection(this.register.components.get(e.entityId),this.projectEditorComponent);(void 0===e||e)&&(t.entityStatus=xt.a.remove,t.entity.childEntities.length&&function t(e,n){for(let o in e.childEntities){let i=e.childEntities[o];n(i),i.childEntities.length&&t(i,n)}}(t.entity,t=>{this.register.components.get(t.entityId).status=xt.a.remove}));for(let e of this.panelManager.activePanels)if(e.hasOwnProperty("editorComponent")&&e.editorComponent.entityId==t.entityId){this.panelManager.backPanel({ignoreValidation:!0});break}n.componentElement.remove(),this.activeProjectionsProp=this.activeProjectionsProp.filter(e=>e.editorComponent.entityId!=t.entityId),t.projection=null,this.reloadSortable(),this.triggerZoneState()}}scrollToProjection(t){if(!t.hasOwnProperty("projection"))return;It(t.projection.componentElement.offset().top-window.innerHeight/2,500)}triggerZoneState(){let t=this.rootElement.find(".projections-zone");this.activeProjections.length?t.removeClass("empty-state"):t.addClass("empty-state")}getTemplate(t){let e=this.app.bodyElement.find(`.wcpf-projection-template[data-projection-key=${t}]`);if(!e.length)return null;let n=e.attr("id");return n&&0===n.indexOf("tmpl-")?wp.template(n.slice(5)):null}}class Ht extends a.a{constructor(){super(...arguments),this.initEditorEvent=new d.a,this.projectLoadedEvent=new d.a}initialProperties(){this.app.packageRegister.set("Editor/Package",this),this.app.objectContainer.set("Editor/ProjectEntity",null),this.app.objectContainer.set("Editor/ProjectComponent",null),this.app.objectContainer.set("Editor/Components",new Map)}getInitialSubpackages(){return[new h,new u,new j,new O,new pt,new Et,new jt]}getInitialComponents(){return[new Kt,new Tt,new Mt]}}class At extends et{get validator(){return jQuery.validator}attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(){this.validator.setDefaults({debug:!0,ignore:".control-inactive,*:not([name])",errorPlacement:Object(W.a)(this.errorPlacement,this)});let t={filterKeyText:"",filterKeyUniquer:"",requiredIfActiveControl:this.validator.messages.required};if(this.localizedMessages.hasOwnProperty("validatorErrors"))for(let e in this.localizedMessages.validatorErrors){let n=this.localizedMessages.validatorErrors[e];t[e]=this.validator.format(n)}this.validator.addMethod("requiredIfActiveControl",Object(W.a)(this.requiredIfActiveControlMethod,this),t.requiredIfActiveControl),this.validator.addMethod("requiredUnit",Object(W.a)(this.requiredUnit,this),this.validator.messages.required),this.validator.addMethod("filterKeyText",Object(W.a)(this.filterKeyTextMethod,this),t.filterKeyText),this.validator.addMethod("filterKeyUniquer",Object(W.a)(this.filterKeyUniquerMethod,this),t.filterKeyUniquer),this.validator.addMethod("filterKeyUniquerDepends",Object(W.a)(this.filterKeyUniquerDependsMethod,this),t.filterKeyUniquer)}requiredUnit(t,e){let n=Object(v.a)(e).parents("form.panel-form");return Object(W.a)(this.validator.methods.required,n.data("validator"))(t,e,t=>Object(v.a)(t).parents(".control-inputs-container:first").find(".text-size").val().length>0)}errorPlacement(t,e){let n=e.parents(".control:first").find(".validation-errors-container:first");n.length?n.append(t):t.insertAfter(e.get(0))}requiredIfActiveControlMethod(t,e,n){let o=Object(v.a)(e),i=o.parents(".control:first"),r=o.parents("form.panel-form");if(!i.hasClass("control-inactive")&&r.data("validator")){return Object(W.a)(this.validator.methods.required,r.data("validator"))(t,e,n)}return!0}filterKeyTextMethod(t,e){return/^[\w\d0-9\-\_]*$/.test(t)}filterKeyUniquerMethod(t,e,n){let o=this.panelManager.getCurrentPanel(),i=null;o.hasOwnProperty("editorComponent")&&(i=o.editorComponent.entityId);for(let[e,n]of this.register.components)if(i!=n.entityId&&"remove"!=n.entityStatus&&"getFilterKeys"in n&&-1!=n.getFilterKeys().indexOf(t))return!1;return!0}filterKeyUniquerDependsMethod(t,e,n){let o=this.panelManager.getCurrentPanel();if(Array.isArray(n))for(let e of n){let n=o.panelLayout.controls.get(e);if(n&&n.optionValue==t)return!1}return!0}}class Bt extends a.a{getInitialComponents(){return[new At]}}class $t extends vt{constructor(){super(),this.afterInitValidationEvent=new d.a,this.validateEvent=new d.a}attachEvents(t){super.attachEvents(t);for(let e of this.panelLayout.controls.values())t.addSystemHandler(e.valueChangedEvent,this.validate)}onLaunched(){let t=this.getValidatorOptions(),e=this.formElement.validate(t);e&&e.hasOwnProperty("settings")&&(e.settings=Object(at.a)(e.settings,t)),this.afterInitValidationEvent.trigger({panel:this,formElement:this.formElement,options:t})}onFormSubmit(t){super.onFormSubmit(t),this.saveValuesOfControls()}validate(){let t=this.formElement.valid();return this.validateEvent.trigger({isValid:t,panel:this}),t}saveValuesOfControls(){this.validate()&&super.saveValuesOfControls()}resetValuesOfControls(){let t=this.panelLayout.isControlsSaved;super.resetValuesOfControls(),t||this.validate()}getValidatorOptions(){return{}}}class qt extends $t{createOptionsRepository(){return this.editorComponent.options}}class Ft extends qt{getValidatorOptions(){return{rules:{entityTitle:{required:!0,minlength:2},filteringStarts:{required:!0},productsContainerSelector:{requiredIfActiveControl:!0},paginationSelector:{requiredIfActiveControl:!0},resultCountSelector:{requiredIfActiveControl:!0},sortingSelector:{requiredIfActiveControl:!0}}}}}class Dt extends et{constructor(){super(),this.options=new rt.a,this.titleChangedEvent=new d.a,this.parentChangedEvent=new d.a,this.statusChangedEvent=new d.a,this.orderChangedEvent=new d.a}get entityId(){return this.entity.entityId}get entityKey(){return this.entity.entityKey}get entityTitle(){return this.entity.title}set entityTitle(t){let e=this.entity.title;this.entity.title=t,this.titleChangedEvent.trigger({title:t,oldTitle:e,entity:this.entity,editorComponent:this})}get entityParentId(){return this.entity.parentId}set entityParentId(t){let e=this.entity.parentId;this.entity.parentId=t,this.parentChangedEvent.trigger({parent:t,oldParent:e,entity:this.entity,editorComponent:this})}get entityStatus(){return this.entity.status}set entityStatus(t){let e=this.entity.status;this.entity.status=t,this.statusChangedEvent.trigger({status:t,oldStatus:e,entity:this.entity,editorComponent:this})}get entityOrder(){return this.entity.order}set entityOrder(t){let e=this.entity.order;this.entity.order=t,this.orderChangedEvent.trigger({order:t,oldOrder:e,entity:this.entity,editorComponent:this})}initialProperties(){this.options.container=this.entity.options}attachEvents(t){t.addSystemHandler(this.parentChangedEvent,this.moveEntityWhenParentChange)}moveEntityWhenParentChange(t){if(!this.register.components.has(t.oldParent)||!this.register.components.has(t.parent))return;let e=this.register.components.get(t.oldParent).entity,n=this.register.components.get(t.parent).entity;e.childEntities=e.childEntities.filter(t=>t.entityId!=this.entityId),n.childEntities.push(this.entity)}}class Qt extends Dt{constructor(){super(...arguments),this.panels=new Set}attachEvents(t){super.attachEvents(t),t.addSystemHandler(this.titleChangedEvent,this.onTitleChanged)}onTitleChanged(t){this.app.bodyElement.find(".wp-heading-inline .project-name").html(t.title)}}class _t extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.panel.set("Project",Ft),t.component.set("Project",Qt)}}class zt extends a.a{getInitialComponents(){return[new _t]}}class Ut extends qt{getValidatorOptions(){return Object(at.a)(super.getValidatorOptions(),{rules:{entityTitle:{required:!0,minlength:2},optionKey:{required:!0,filterKeyText:!0,filterKeyUniquer:!0,minlength:2},itemsSource:{required:!0},itemsSourceAttribute:{requiredIfActiveControl:!0},itemsSourceCategory:{requiredIfActiveControl:!0},itemsSourceTaxonomy:{requiredIfActiveControl:!0},itemsDisplay:{requiredIfActiveControl:!0},queryType:{requiredIfActiveControl:!0},titleItemReset:{requiredIfActiveControl:!0,minlength:2}}})}}class Gt extends Dt{constructor(){super(...arguments),this.panels=new Set,this.projection=null}}class Wt extends Gt{getFilterKeys(){return[this.options.get("optionKey")]}}class Nt extends y{constructor(){super(),this.moveProjectionEvent=new d.a}attachEvents(t){}initialProjection(){}get entity(){return this.editorComponent.entity}get entityOptions(){return this.editorComponent.options}getTemplateContext(){return{}}}class Jt extends Nt{get titleElement(){return this.componentElement.find(".entity-title")}attachEvents(t){super.attachEvents(t),this.addElementHandler("click",".actions-wrapper .edit-action",this.onEditClick),this.addElementHandler("click",".actions-wrapper .remove-action",this.onRemoveClick),t.addSystemHandler(this.editorComponent.titleChangedEvent,this.onTitleChanged)}onRemoveClick(t){this.projectionManager.removeProjection(this.editorComponent,!0)}onEditClick(t){this.panelManager.openPanel(this.editorComponent.entityKey,{},this.editorComponent.entityId)}onTitleChanged(t){this.titleElement.html(t.title)}getTemplateContext(){return{entity:this.entity}}}class Zt extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("CheckBoxListField",Wt),t.panel.set("CheckBoxListField",Ut),t.projection.set("CheckBoxListField",Jt)}}class Yt extends a.a{getInitialComponents(){return[new Zt]}}class Xt extends et{attachEvents(t){this.app.packageRegister.get("Editor/Package");t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("RadioListField",Wt),t.panel.set("RadioListField",Ut),t.projection.set("RadioListField",Jt)}}class te extends a.a{getInitialComponents(){return[new Xt]}}class ee extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("DropDownListField",Wt),t.panel.set("DropDownListField",Ut),t.projection.set("DropDownListField",Jt)}}class ne extends a.a{getInitialComponents(){return[new ee]}}class oe extends qt{getValidatorOptions(){return Object(at.a)(super.getValidatorOptions(),{rules:{entityTitle:{required:!0,minlength:2},action:{required:!0}}})}}class ie extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("ButtonField",Gt),t.panel.set("ButtonField",oe),t.projection.set("ButtonField",Jt)}}class re extends a.a{getInitialComponents(){return[new ie]}}class se extends qt{getValidatorOptions(){return Object(at.a)(super.getValidatorOptions(),{rules:{entityTitle:{required:!0,minlength:2},optionKey:{requiredIfActiveControl:!0,filterKeyText:!0,filterKeyUniquer:!0,minlength:2},minPriceOptionKey:{requiredIfActiveControl:!0,filterKeyText:!0,filterKeyUniquer:!0,minlength:2},maxPriceOptionKey:{requiredIfActiveControl:!0,filterKeyText:!0,filterKeyUniquer:!0,filterKeyUniquerDepends:["minPriceOptionKey"],minlength:2}}})}}class ae extends Gt{getFilterKeys(){let t=[];return"dash"==this.options.get("optionKeyFormat")?t.push(this.options.get("optionKey")):"two"==this.options.get("optionKeyFormat")&&(t.push(this.options.get("minPriceOptionKey")),t.push(this.options.get("maxPriceOptionKey"))),t}}class le extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("PriceSliderField",ae),t.panel.set("PriceSliderField",se),t.projection.set("PriceSliderField",Jt)}}class ce extends a.a{getInitialComponents(){return[new le]}}class pe extends Ut{getValidatorOptions(){let t=super.getValidatorOptions();return t.rules=Object(at.a)(t.rules,{boxSize:{required:!0,number:!0,min:1},boxSizeUnit:{requiredUnit:!0}}),t}}class de extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("BoxListField",Wt),t.panel.set("BoxListField",pe),t.projection.set("BoxListField",Jt)}}class he extends a.a{getInitialComponents(){return[new de]}}class ue extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("TextListField",Wt),t.panel.set("TextListField",Ut),t.projection.set("TextListField",Jt)}}class me extends a.a{getInitialComponents(){return[new ue]}}class ge extends Ut{getValidatorOptions(){let t=super.getValidatorOptions();return t.rules=Object(at.a)(t.rules,{colors:{repeaterItem:{type:{required:!0},term:{required:!0},markerStyle:{required:!0},color:{requiredIfActiveControl:!0}}}}),t}}class ye extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("ColorListField",Wt),t.panel.set("ColorListField",ge),t.projection.set("ColorListField",Jt)}}class fe extends a.a{getInitialComponents(){return[new ye]}}class Ee extends a.a{getInitialSubpackages(){return[new Yt,new te,new ne,new re,new ce,new he,new me,new fe]}getInitialComponents(){return[]}}class ve extends qt{createOptionsRepository(){let t=this.editorComponent.entity.options.columns[this.panelContext.columnIndex].options;return new rt.a(t)}getValidatorOptions(){return{rules:{width:{required:!0,number:!0,min:1},widthUnit:{requiredUnit:!0}}}}}class Ce extends Dt{constructor(){super(...arguments),this.panels=new Set,this.projection=null}}var Pe=class extends Nt{constructor(){super(),this.moveChildProjectionEvent=new d.a}};var be=class extends Pe{attachEvents(t){super.attachEvents(t),this.addElementHandler("click",`.actions-wrapper.entity-id-${this.editorComponent.entityId} .remove-action`,this.onRemoveClick),this.addElementHandler("click",`.actions-wrapper.entity-id-${this.editorComponent.entityId} .edit-action`,this.onEditClick)}onRemoveClick(t){this.projectionManager.removeProjection(this.editorComponent,!0)}onEditClick(t){this.panelManager.openPanel(this.editorComponent.entityKey,{},this.editorComponent.entityId)}getTemplateContext(){return{entity:this.entity}}};class je extends be{get columns(){return this.entityOptions.get("columns")}set columns(t){this.entityOptions.set("columns",t)}initialProjection(){super.initialProjection(),Array.isArray(this.columns)||(this.columns=$(this.columns));for(let t=0;t<this.columns.length;t++)Array.isArray(this.columns[t].entities)||(this.columns[t].entities=$(this.columns[t].entities)),Array.isArray(this.columns[t].options)&&(this.columns[t].options=Object.assign({},this.columns[t].options)),this.createColumnElement(t)}attachEvents(t){super.attachEvents(t),t.addSystemHandler(this.moveChildProjectionEvent,this.onMoveChildProjection),this.addElementHandler("click",`.actions-wrapper.entity-id-${this.editorComponent.entityId} .add-column-action`,this.onAddColumnClick),this.addElementHandler("click",`.column-item .actions.entity-id-${this.editorComponent.entityId} .remove-action`,this.onRemoveColumnClick),this.addElementHandler("click",`.column-item .actions.entity-id-${this.editorComponent.entityId} .edit-action`,this.onEditColumnClick)}onEditColumnClick(t){let e=Object(C.a)(t).parents(".column-item:first").data("column-index");this.panelManager.openPanel("ColumnsLayoutItem",{columnIndex:e},this.editorComponent.entityId)}onRemoveColumnClick(t){let e=Object(C.a)(t).parents(".column-item:first").data("column-index");this.removeColumn(e)}onAddColumnClick(t){let e=this.createEmptyColumn();this.panelManager.openPanel("ColumnsLayoutItem",{columnIndex:e},this.editorComponent.entityId)}onMoveChildProjection(t){t.editorComponent.hasOwnProperty("projection")&&(t.direction==Lt.same?(this.outsideChild(t.editorComponent),this.insideChild(t.editorComponent)):t.direction==Lt.inside?this.insideChild(t.editorComponent):t.direction==Lt.outside&&this.outsideChild(t.editorComponent))}insideChild(t){let e=t.projection.componentElement,n=".column-item.entity-id-"+this.editorComponent.entityId,o=e.parents(n).data("column-index"),i=this.columns;i[o].entities.push(t.entityId),this.columns=i}outsideChild(t){let e=0,n=this.columns;for(let o in n){let i=n[o];for(let n of i.entities)if(n==t.entityId){e=o;break}}n[e].entities=n[e].entities.filter(e=>e!=t.entityId),this.columns=n}insertChildComponentElement(t,e){let n=this.columns,o=0;for(let t in n){let i=n[t];for(let n of i.entities)if(n==e.entityId){o=t;break}}this.getColumnContentElement(o).append(t)}createEmptyColumn(){let t=this.columns;t.push({entities:[],options:{}}),this.columns=t;let e=t.length-1;return this.createColumnElement(e),e}createColumnElement(t){let e=Object(v.a)(`\n            <div class="column-item column-item-${t} entity-id-${this.editorComponent.entityId}"\n                data-column-index="${t}">\n                <div class="column-header">\n                    <div class="column-title">\n                        <span class="text">${this.localizedMessages.columnsLayout.column} ${t}</span>\n                    </div>\n                    <div class="actions entity-id-${this.editorComponent.entityId}">\n                        <div class="button-link edit-action">\n                            <span class="text">${this.localizedMessages.columnsLayout.edit}</span>\n                        </div>\n                        <div class="button-link remove-action">\n                            <span class="text">${this.localizedMessages.columnsLayout.remove}</span>\n                        </div>\n                    </div>\n                </div>\n                <div class="sort-list column-content entity-id-${this.editorComponent.entityId}"></div>\n            </div>\n        `);return this.componentElement.find(".body-container:first").append(e),this.projectionManager.reloadSortable(),e}removeColumn(t){if(0==t)return;let e=this.columns;if(e.length>t&&0<=t){let n=e[t].entities;e.splice(t,1),this.columns=e;for(let t of n)this.register.components.has(t)&&this.projectionManager.moveProjection(this.register.components.get(t),this.editorComponent);this.removeColumnElement(t);for(let n=t+1;n<=e.length;n++){let t=n-1,e=this.getColumnElement(n);e.removeClass("column-item-"+n).addClass("column-item-"+t).attr("data-column-index",t),e.find("> .column-header .column-title .text").html(this.localizedMessages.columnsLayout.column+" "+t)}}}removeColumnElement(t){this.getColumnElement(t).remove(),this.projectionManager.reloadSortable()}getColumnElement(t){return this.componentElement.find(`.column-item.column-item-${t}.entity-id-${this.editorComponent.entityId}`)}getColumnContentElement(t){return this.componentElement.find(`.column-item.column-item-${t} .column-content.entity-id-${this.editorComponent.entityId}`)}}class Oe extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("ColumnsLayout",Ce),t.panel.set("ColumnsLayoutItem",ve),t.projection.set("ColumnsLayout",je)}}class we extends a.a{getInitialComponents(){return[new Oe]}}class ke extends be{get titleElement(){return this.componentElement.find(`.title-container.entity-id-${this.editorComponent.entityId} .entity-title`)}get containerElement(){return this.componentElement.find(".sort-list.entity-id-"+this.editorComponent.entityId)}attachEvents(t){super.attachEvents(t),t.addSystemHandler(this.editorComponent.titleChangedEvent,this.onTitleChanged)}onTitleChanged(t){this.titleElement.html(t.title)}insertChildComponentElement(t,e){this.containerElement.append(t)}}class Se extends qt{getValidatorOptions(){return{rules:{entityTitle:{required:!0,minlength:2},defaultToggleState:{requiredIfActiveControl:!0}}}}}class Ve extends et{attachEvents(t){t.addSystemHandler(this.editorPackage.initEditorEvent,this.initEditor)}initEditor(t){t.component.set("SimpleBoxLayout",Ce),t.panel.set("SimpleBoxLayout",Se),t.projection.set("SimpleBoxLayout",ke)}}class Ie extends a.a{getInitialComponents(){return[new Ve]}}class Re extends a.a{getInitialSubpackages(){return[new we,new Ie]}getInitialComponents(){return[]}}class xe extends o.a{initialization(){let t=new i.a,e=new r.a;this.objectContainer.set("ComponentBuilder",e),t.build(new p,this),t.build(new s.a,this),t.build(new Ht,this),t.build(new Bt,this),t.build(new zt,this),t.build(new Ee,this),t.build(new Re,this)}}let Ke=new xe;Ke.initialization(),window.wcpfAdminApp=Ke}]);